2025-07-12 16:46:48.386 +03:00 [INF] Executed DbCommand (12ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-07-12 16:46:48.434 +03:00 [INF] Executed DbCommand (13ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-07-12 16:46:48.437 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-07-12 16:46:48.506 +03:00 [INF] Executed DbCommand (31ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [__EFMigrationsHistory] (
    [MigrationId] nvarchar(150) NOT NULL,
    [ProductVersion] nvarchar(32) NOT NULL,
    CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
);
2025-07-12 16:46:48.509 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-07-12 16:46:48.512 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-07-12 16:46:48.535 +03:00 [INF] Executed DbCommand (19ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-07-12 16:46:48.544 +03:00 [INF] Applying migration '20250712134611_InitialCreate'.
2025-07-12 16:46:48.578 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Users] (
    [Id] int NOT NULL IDENTITY,
    [Username] nvarchar(50) NOT NULL,
    [PasswordHash] nvarchar(max) NOT NULL,
    [Deposit] decimal(18,2) NOT NULL,
    [Role] int NOT NULL,
    [CreatedAt] datetime2 NOT NULL,
    [UpdatedAt] datetime2 NOT NULL,
    CONSTRAINT [PK_Users] PRIMARY KEY ([Id])
);
2025-07-12 16:46:48.584 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Products] (
    [Id] int NOT NULL IDENTITY,
    [ProductName] nvarchar(100) NOT NULL,
    [AmountAvailable] int NOT NULL,
    [Cost] decimal(18,2) NOT NULL,
    [SellerId] int NOT NULL,
    [CreatedAt] datetime2 NOT NULL,
    [UpdatedAt] datetime2 NOT NULL,
    CONSTRAINT [PK_Products] PRIMARY KEY ([Id]),
    CONSTRAINT [FK_Products_Users_SellerId] FOREIGN KEY ([SellerId]) REFERENCES [Users] ([Id]) ON DELETE NO ACTION
);
2025-07-12 16:46:48.588 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Transactions] (
    [Id] int NOT NULL IDENTITY,
    [BuyerId] int NOT NULL,
    [ProductId] int NOT NULL,
    [Amount] int NOT NULL,
    [TotalSpent] decimal(18,2) NOT NULL,
    [Change] decimal(18,2) NOT NULL,
    [CreatedAt] datetime2 NOT NULL,
    CONSTRAINT [PK_Transactions] PRIMARY KEY ([Id]),
    CONSTRAINT [FK_Transactions_Products_ProductId] FOREIGN KEY ([ProductId]) REFERENCES [Products] ([Id]) ON DELETE NO ACTION,
    CONSTRAINT [FK_Transactions_Users_BuyerId] FOREIGN KEY ([BuyerId]) REFERENCES [Users] ([Id]) ON DELETE NO ACTION
);
2025-07-12 16:46:48.593 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_Products_SellerId] ON [Products] ([SellerId]);
2025-07-12 16:46:48.595 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_Transactions_BuyerId] ON [Transactions] ([BuyerId]);
2025-07-12 16:46:48.597 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_Transactions_ProductId] ON [Transactions] ([ProductId]);
2025-07-12 16:46:48.599 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE UNIQUE INDEX [IX_Users_Username] ON [Users] ([Username]);
2025-07-12 16:46:48.609 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT INTO [__EFMigrationsHistory] ([MigrationId], [ProductVersion])
VALUES (N'20250712134611_InitialCreate', N'8.0.0');
2025-07-12 16:51:00.468 +03:00 [INF] User profile is available. Using 'C:\Users\osmohamed\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-07-12 16:51:00.561 +03:00 [INF] Now listening on: http://localhost:5000
2025-07-12 16:51:00.563 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-07-12 16:51:00.565 +03:00 [INF] Hosting environment: Production
2025-07-12 16:51:00.566 +03:00 [INF] Content root path: C:\Users\osmohamed\Documents\Omar\Vending-machine\src\VendingMachine.API
2025-07-12 16:51:03.634 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/swagger/index.html - null null
2025-07-12 16:51:03.714 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5000/swagger/index.html - 200 null text/html;charset=utf-8 81.2098ms
2025-07-12 16:51:04.523 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/swagger/v1/swagger.json - null null
2025-07-12 16:51:04.699 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5000/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 176.2235ms
2025-07-12 16:51:47.031 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/Auth/register - application/json 62
2025-07-12 16:51:47.041 +03:00 [WRN] Failed to determine the https port for redirect.
2025-07-12 16:51:47.044 +03:00 [INF] CORS policy execution successful.
2025-07-12 16:51:47.089 +03:00 [INF] Executing endpoint 'VendingMachine.API.Controllers.AuthController.Register (VendingMachine.API)'
2025-07-12 16:51:47.123 +03:00 [INF] Route matched with {action = "Register", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Register(VendingMachine.Core.DTOs.CreateUserDto) on controller VendingMachine.API.Controllers.AuthController (VendingMachine.API).
2025-07-12 16:51:47.133 +03:00 [INF] Executed action VendingMachine.API.Controllers.AuthController.Register (VendingMachine.API) in 2.9996ms
2025-07-12 16:51:47.135 +03:00 [INF] Executed endpoint 'VendingMachine.API.Controllers.AuthController.Register (VendingMachine.API)'
2025-07-12 16:51:47.138 +03:00 [ERR] Connection id "0HNE19CI8C956", Request id "0HNE19CI8C956:00000001": An unhandled exception was thrown by the application.
System.InvalidOperationException: Unable to resolve service for type 'VendingMachine.Infrastructure.Services.UserService' while attempting to activate 'VendingMachine.API.Controllers.AuthController'.
   at Microsoft.Extensions.DependencyInjection.ActivatorUtilities.ThrowHelperUnableToResolveService(Type type, Type requiredBy)
   at lambda_method10(Closure, IServiceProvider, Object[])
   at Microsoft.AspNetCore.Mvc.Controllers.ControllerFactoryProvider.<>c__DisplayClass6_0.<CreateControllerFactory>g__CreateController|0(ControllerContext controllerContext)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-07-12 16:51:47.165 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/Auth/register - 500 0 null 134.7571ms
2025-07-12 16:52:34.720 +03:00 [INF] Application is shutting down...
2025-07-12 16:52:38.113 +03:00 [INF] User profile is available. Using 'C:\Users\osmohamed\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-07-12 16:52:38.189 +03:00 [INF] Now listening on: http://localhost:5000
2025-07-12 16:52:38.192 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-07-12 16:52:38.194 +03:00 [INF] Hosting environment: Production
2025-07-12 16:52:38.195 +03:00 [INF] Content root path: C:\Users\osmohamed\Documents\Omar\Vending-machine\src\VendingMachine.API
2025-07-12 16:52:40.418 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/Auth/register - application/json 62
2025-07-12 16:52:40.457 +03:00 [WRN] Failed to determine the https port for redirect.
2025-07-12 16:52:40.462 +03:00 [INF] CORS policy execution successful.
2025-07-12 16:52:40.499 +03:00 [INF] Executing endpoint 'VendingMachine.API.Controllers.AuthController.Register (VendingMachine.API)'
2025-07-12 16:52:40.533 +03:00 [INF] Route matched with {action = "Register", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Register(VendingMachine.Core.DTOs.CreateUserDto) on controller VendingMachine.API.Controllers.AuthController (VendingMachine.API).
2025-07-12 16:52:41.509 +03:00 [ERR] Failed executing DbCommand (39ms) [Parameters=[@__username_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Users] AS [u]
        WHERE [u].[Username] = @__username_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-07-12 16:52:41.542 +03:00 [ERR] An exception occurred while iterating over the results of a query for context type 'VendingMachine.Infrastructure.Data.VendingMachineDbContext'.
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid object name 'Users'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
ClientConnectionId:d69914ec-1440-44d6-85e0-b9fd30714ab0
Error Number:208,State:1,Class:16
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid object name 'Users'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
ClientConnectionId:d69914ec-1440-44d6-85e0-b9fd30714ab0
Error Number:208,State:1,Class:16
2025-07-12 16:52:41.548 +03:00 [ERR] Error during user registration for Omar
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid object name 'Users'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at VendingMachine.Infrastructure.Services.UserService.RegisterAsync(String username, String password, UserRole role) in C:\Users\osmohamed\Documents\Omar\Vending-machine\src\VendingMachine.Infrastructure\Services\UserService.cs:line 23
   at VendingMachine.API.Controllers.AuthController.Register(CreateUserDto createUserDto) in C:\Users\osmohamed\Documents\Omar\Vending-machine\src\VendingMachine.API\Controllers\AuthController.cs:line 30
ClientConnectionId:d69914ec-1440-44d6-85e0-b9fd30714ab0
Error Number:208,State:1,Class:16
2025-07-12 16:52:41.565 +03:00 [INF] Executing BadRequestObjectResult, writing value of type '<>f__AnonymousType0`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-12 16:52:41.577 +03:00 [INF] Executed action VendingMachine.API.Controllers.AuthController.Register (VendingMachine.API) in 1037.8137ms
2025-07-12 16:52:41.580 +03:00 [INF] Executed endpoint 'VendingMachine.API.Controllers.AuthController.Register (VendingMachine.API)'
2025-07-12 16:52:41.589 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/Auth/register - 400 null application/json; charset=utf-8 1172.5077ms
2025-07-12 16:53:18.085 +03:00 [INF] Application is shutting down...
2025-07-12 16:56:05.928 +03:00 [INF] User profile is available. Using 'C:\Users\osmohamed\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-07-12 16:56:06.113 +03:00 [INF] Now listening on: http://localhost:5000
2025-07-12 16:56:06.115 +03:00 [INF] Now listening on: https://localhost:5001
2025-07-12 16:56:06.118 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-07-12 16:56:06.120 +03:00 [INF] Hosting environment: Development
2025-07-12 16:56:06.121 +03:00 [INF] Content root path: C:\Users\osmohamed\Documents\Omar\Vending-machine\src\VendingMachine.API
2025-07-12 16:56:12.802 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/swagger/index.html - null null
2025-07-12 16:56:12.903 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5000/swagger/index.html - 200 null text/html;charset=utf-8 101.4277ms
2025-07-12 16:56:13.733 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/swagger/v1/swagger.json - null null
2025-07-12 16:56:13.936 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5000/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 202.9929ms
2025-07-12 16:56:26.883 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/Auth/register - application/json 62
2025-07-12 16:56:26.916 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/Auth/register - 307 0 null 32.7559ms
2025-07-12 16:56:27.016 +03:00 [INF] Request starting HTTP/2 OPTIONS https://localhost:5001/api/Auth/register - null null
2025-07-12 16:56:27.023 +03:00 [INF] CORS policy execution successful.
2025-07-12 16:56:27.028 +03:00 [INF] Request finished HTTP/2 OPTIONS https://localhost:5001/api/Auth/register - 204 null null 11.9708ms
2025-07-12 16:56:27.036 +03:00 [INF] Request starting HTTP/2 POST https://localhost:5001/api/Auth/register - application/json 62
2025-07-12 16:56:27.041 +03:00 [INF] CORS policy execution successful.
2025-07-12 16:56:27.085 +03:00 [INF] Executing endpoint 'VendingMachine.API.Controllers.AuthController.Register (VendingMachine.API)'
2025-07-12 16:56:27.122 +03:00 [INF] Route matched with {action = "Register", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Register(VendingMachine.Core.DTOs.CreateUserDto) on controller VendingMachine.API.Controllers.AuthController (VendingMachine.API).
2025-07-12 16:56:28.469 +03:00 [INF] Executed DbCommand (46ms) [Parameters=[@__username_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Users] AS [u]
        WHERE [u].[Username] = @__username_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-07-12 16:56:28.632 +03:00 [INF] Executed DbCommand (13ms) [Parameters=[@p0='?' (DbType = DateTime2), @p1='?' (Precision = 18) (Scale = 2) (DbType = Decimal), @p2='?' (Size = 4000), @p3='?' (DbType = Int32), @p4='?' (DbType = DateTime2), @p5='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Users] ([CreatedAt], [Deposit], [PasswordHash], [Role], [UpdatedAt], [Username])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5);
2025-07-12 16:56:28.661 +03:00 [INF] Executing OkObjectResult, writing value of type 'VendingMachine.Core.DTOs.UserResponseDto'.
2025-07-12 16:56:28.679 +03:00 [INF] Executed action VendingMachine.API.Controllers.AuthController.Register (VendingMachine.API) in 1550.307ms
2025-07-12 16:56:28.682 +03:00 [INF] Executed endpoint 'VendingMachine.API.Controllers.AuthController.Register (VendingMachine.API)'
2025-07-12 16:56:28.693 +03:00 [INF] Request finished HTTP/2 POST https://localhost:5001/api/Auth/register - 200 null application/json; charset=utf-8 1656.4629ms
2025-07-12 16:56:42.973 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/Auth/login - application/json 49
2025-07-12 16:56:42.977 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/Auth/login - 307 0 null 3.8177ms
2025-07-12 16:56:42.980 +03:00 [INF] Request starting HTTP/2 OPTIONS https://localhost:5001/api/Auth/login - null null
2025-07-12 16:56:42.983 +03:00 [INF] CORS policy execution successful.
2025-07-12 16:56:42.986 +03:00 [INF] Request finished HTTP/2 OPTIONS https://localhost:5001/api/Auth/login - 204 null null 5.9517ms
2025-07-12 16:56:42.988 +03:00 [INF] Request starting HTTP/2 POST https://localhost:5001/api/Auth/login - application/json 49
2025-07-12 16:56:42.992 +03:00 [INF] CORS policy execution successful.
2025-07-12 16:56:42.995 +03:00 [INF] Executing endpoint 'VendingMachine.API.Controllers.AuthController.Login (VendingMachine.API)'
2025-07-12 16:56:43.000 +03:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(VendingMachine.API.Controllers.LoginDto) on controller VendingMachine.API.Controllers.AuthController (VendingMachine.API).
2025-07-12 16:56:43.061 +03:00 [INF] Executed DbCommand (10ms) [Parameters=[@__username_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[Id], [u].[CreatedAt], [u].[Deposit], [u].[PasswordHash], [u].[Role], [u].[UpdatedAt], [u].[Username]
FROM [Users] AS [u]
WHERE [u].[Username] = @__username_0
2025-07-12 16:56:43.094 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType1`2[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[VendingMachine.Core.DTOs.UserResponseDto, VendingMachine.Core, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-12 16:56:43.099 +03:00 [INF] Executed action VendingMachine.API.Controllers.AuthController.Login (VendingMachine.API) in 97.6728ms
2025-07-12 16:56:43.101 +03:00 [INF] Executed endpoint 'VendingMachine.API.Controllers.AuthController.Login (VendingMachine.API)'
2025-07-12 16:56:43.102 +03:00 [INF] Request finished HTTP/2 POST https://localhost:5001/api/Auth/login - 200 null application/json; charset=utf-8 113.4933ms
2025-07-12 16:56:55.083 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/Buyer/deposit - application/json 19
2025-07-12 16:56:55.087 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/Buyer/deposit - 307 0 null 3.5206ms
2025-07-12 16:56:55.095 +03:00 [INF] Request starting HTTP/2 OPTIONS https://localhost:5001/api/Buyer/deposit - null null
2025-07-12 16:56:55.101 +03:00 [INF] CORS policy execution successful.
2025-07-12 16:56:55.102 +03:00 [INF] Request finished HTTP/2 OPTIONS https://localhost:5001/api/Buyer/deposit - 204 null null 6.7818ms
2025-07-12 16:56:55.104 +03:00 [INF] Request starting HTTP/2 POST https://localhost:5001/api/Buyer/deposit - application/json 19
2025-07-12 16:56:55.107 +03:00 [INF] CORS policy execution successful.
2025-07-12 16:56:55.112 +03:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: The AuthorizationPolicy named: 'BuyerOnly' was not found.
   at Microsoft.AspNetCore.Authorization.AuthorizationPolicy.CombineAsync(IAuthorizationPolicyProvider policyProvider, IEnumerable`1 authorizeData, IEnumerable`1 policies)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-07-12 16:56:55.128 +03:00 [INF] Request finished HTTP/2 POST https://localhost:5001/api/Buyer/deposit - 500 null text/plain; charset=utf-8 24.0015ms
2025-07-12 16:57:48.468 +03:00 [INF] Application is shutting down...
2025-07-12 16:57:51.614 +03:00 [INF] User profile is available. Using 'C:\Users\osmohamed\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-07-12 16:57:51.782 +03:00 [INF] Now listening on: http://localhost:5000
2025-07-12 16:57:51.783 +03:00 [INF] Now listening on: https://localhost:5001
2025-07-12 16:57:51.786 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-07-12 16:57:51.787 +03:00 [INF] Hosting environment: Development
2025-07-12 16:57:51.791 +03:00 [INF] Content root path: C:\Users\osmohamed\Documents\Omar\Vending-machine\src\VendingMachine.API
2025-07-12 16:57:59.440 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/Buyer/deposit - application/json 19
2025-07-12 16:57:59.493 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/Buyer/deposit - 307 0 null 55.3639ms
2025-07-12 16:57:59.586 +03:00 [INF] Request starting HTTP/2 OPTIONS https://localhost:5001/api/Buyer/deposit - null null
2025-07-12 16:57:59.597 +03:00 [INF] CORS policy execution successful.
2025-07-12 16:57:59.600 +03:00 [INF] Request finished HTTP/2 OPTIONS https://localhost:5001/api/Buyer/deposit - 204 null null 14.6422ms
2025-07-12 16:57:59.614 +03:00 [INF] Request starting HTTP/2 POST https://localhost:5001/api/Buyer/deposit - application/json 19
2025-07-12 16:57:59.618 +03:00 [INF] CORS policy execution successful.
2025-07-12 16:57:59.670 +03:00 [INF] Authorization failed. These requirements were not met:
RolesAuthorizationRequirement:User.IsInRole must be true for one of the following roles: (Buyer)
2025-07-12 16:57:59.678 +03:00 [INF] AuthenticationScheme: Bearer was challenged.
2025-07-12 16:57:59.679 +03:00 [INF] Request finished HTTP/2 POST https://localhost:5001/api/Buyer/deposit - 401 0 null 65.7163ms
2025-07-12 16:58:12.443 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/api/Products - null null
2025-07-12 16:58:12.452 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5000/api/Products - 307 0 null 9.0903ms
2025-07-12 16:58:12.462 +03:00 [INF] Request starting HTTP/2 GET https://localhost:5001/api/Products - null null
2025-07-12 16:58:12.465 +03:00 [INF] CORS policy execution successful.
2025-07-12 16:58:12.469 +03:00 [INF] Executing endpoint 'VendingMachine.API.Controllers.ProductsController.GetProducts (VendingMachine.API)'
2025-07-12 16:58:12.486 +03:00 [INF] Route matched with {action = "GetProducts", controller = "Products"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetProducts() on controller VendingMachine.API.Controllers.ProductsController (VendingMachine.API).
2025-07-12 16:58:13.647 +03:00 [INF] Executed DbCommand (39ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[Id], [p].[ProductName], [p].[AmountAvailable], [p].[Cost], [p].[SellerId], [u].[Username] AS [SellerName], [p].[CreatedAt], [p].[UpdatedAt]
FROM [Products] AS [p]
INNER JOIN [Users] AS [u] ON [p].[SellerId] = [u].[Id]
2025-07-12 16:58:13.676 +03:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[VendingMachine.Core.DTOs.ProductResponseDto, VendingMachine.Core, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-12 16:58:13.704 +03:00 [INF] Executed action VendingMachine.API.Controllers.ProductsController.GetProducts (VendingMachine.API) in 1212.1545ms
2025-07-12 16:58:13.709 +03:00 [INF] Executed endpoint 'VendingMachine.API.Controllers.ProductsController.GetProducts (VendingMachine.API)'
2025-07-12 16:58:13.716 +03:00 [INF] Request finished HTTP/2 GET https://localhost:5001/api/Products - 200 null application/json; charset=utf-8 1254.2202ms
2025-07-12 16:59:12.623 +03:00 [INF] Application is shutting down...
2025-07-12 16:59:40.020 +03:00 [INF] User profile is available. Using 'C:\Users\osmohamed\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-07-12 16:59:40.155 +03:00 [INF] Now listening on: http://localhost:5000
2025-07-12 16:59:40.157 +03:00 [INF] Now listening on: https://localhost:5001
2025-07-12 16:59:40.159 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-07-12 16:59:40.159 +03:00 [INF] Hosting environment: Development
2025-07-12 16:59:40.160 +03:00 [INF] Content root path: C:\Users\osmohamed\Documents\Omar\Vending-machine\src\VendingMachine.API
2025-07-12 16:59:41.851 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/swagger/index.html - null null
2025-07-12 16:59:41.980 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5000/swagger/index.html - 200 null text/html;charset=utf-8 130.9612ms
2025-07-12 16:59:42.714 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/swagger/v1/swagger.json - null null
2025-07-12 16:59:42.866 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5000/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 152.2401ms
2025-07-12 17:00:04.700 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/Products - application/json 70
2025-07-12 17:00:04.710 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/Products - 307 0 null 10.1678ms
2025-07-12 17:00:04.785 +03:00 [INF] Request starting HTTP/2 OPTIONS https://localhost:5001/api/Products - null null
2025-07-12 17:00:04.793 +03:00 [INF] CORS policy execution successful.
2025-07-12 17:00:04.795 +03:00 [INF] Request finished HTTP/2 OPTIONS https://localhost:5001/api/Products - 204 null null 9.881ms
2025-07-12 17:00:04.802 +03:00 [INF] Request starting HTTP/2 POST https://localhost:5001/api/Products - application/json 70
2025-07-12 17:00:04.807 +03:00 [INF] CORS policy execution successful.
2025-07-12 17:00:04.837 +03:00 [INF] Authorization failed. These requirements were not met:
RolesAuthorizationRequirement:User.IsInRole must be true for one of the following roles: (Seller)
2025-07-12 17:00:04.842 +03:00 [INF] AuthenticationScheme: Bearer was challenged.
2025-07-12 17:00:04.844 +03:00 [INF] Request finished HTTP/2 POST https://localhost:5001/api/Products - 401 0 null 42.2063ms
2025-07-12 17:00:28.067 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/Auth/login - application/json 49
2025-07-12 17:00:28.070 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/Auth/login - 307 0 null 3.1519ms
2025-07-12 17:00:28.079 +03:00 [INF] Request starting HTTP/2 OPTIONS https://localhost:5001/api/Auth/login - null null
2025-07-12 17:00:28.081 +03:00 [INF] CORS policy execution successful.
2025-07-12 17:00:28.081 +03:00 [INF] Request finished HTTP/2 OPTIONS https://localhost:5001/api/Auth/login - 204 null null 2.4734ms
2025-07-12 17:00:28.083 +03:00 [INF] Request starting HTTP/2 POST https://localhost:5001/api/Auth/login - application/json 49
2025-07-12 17:00:28.085 +03:00 [INF] CORS policy execution successful.
2025-07-12 17:00:28.092 +03:00 [INF] Executing endpoint 'VendingMachine.API.Controllers.AuthController.Login (VendingMachine.API)'
2025-07-12 17:00:28.122 +03:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(VendingMachine.API.Controllers.LoginDto) on controller VendingMachine.API.Controllers.AuthController (VendingMachine.API).
2025-07-12 17:00:28.987 +03:00 [INF] Executed DbCommand (34ms) [Parameters=[@__username_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[Id], [u].[CreatedAt], [u].[Deposit], [u].[PasswordHash], [u].[Role], [u].[UpdatedAt], [u].[Username]
FROM [Users] AS [u]
WHERE [u].[Username] = @__username_0
2025-07-12 17:00:29.057 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType1`2[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[VendingMachine.Core.DTOs.UserResponseDto, VendingMachine.Core, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-12 17:00:29.073 +03:00 [INF] Executed action VendingMachine.API.Controllers.AuthController.Login (VendingMachine.API) in 945.3461ms
2025-07-12 17:00:29.074 +03:00 [INF] Executed endpoint 'VendingMachine.API.Controllers.AuthController.Login (VendingMachine.API)'
2025-07-12 17:00:29.081 +03:00 [INF] Request finished HTTP/2 POST https://localhost:5001/api/Auth/login - 200 null application/json; charset=utf-8 997.3423ms
2025-07-12 17:00:38.202 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/Products - application/json 70
2025-07-12 17:00:38.207 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/Products - 307 0 null 4.6815ms
2025-07-12 17:00:38.215 +03:00 [INF] Request starting HTTP/2 OPTIONS https://localhost:5001/api/Products - null null
2025-07-12 17:00:38.220 +03:00 [INF] CORS policy execution successful.
2025-07-12 17:00:38.225 +03:00 [INF] Request finished HTTP/2 OPTIONS https://localhost:5001/api/Products - 204 null null 9.8576ms
2025-07-12 17:00:38.229 +03:00 [INF] Request starting HTTP/2 POST https://localhost:5001/api/Products - application/json 70
2025-07-12 17:00:38.232 +03:00 [INF] CORS policy execution successful.
2025-07-12 17:00:38.235 +03:00 [INF] Authorization failed. These requirements were not met:
RolesAuthorizationRequirement:User.IsInRole must be true for one of the following roles: (Seller)
2025-07-12 17:00:38.240 +03:00 [INF] AuthenticationScheme: Bearer was challenged.
2025-07-12 17:00:38.242 +03:00 [INF] Request finished HTTP/2 POST https://localhost:5001/api/Products - 401 0 null 13.1368ms
2025-07-12 17:03:10.281 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/Auth/register - application/json 61
2025-07-12 17:03:10.287 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/Auth/register - 307 0 null 6.2911ms
2025-07-12 17:03:10.304 +03:00 [INF] Request starting HTTP/2 OPTIONS https://localhost:5001/api/Auth/register - null null
2025-07-12 17:03:10.309 +03:00 [INF] CORS policy execution successful.
2025-07-12 17:03:10.310 +03:00 [INF] Request finished HTTP/2 OPTIONS https://localhost:5001/api/Auth/register - 204 null null 6.1487ms
2025-07-12 17:03:10.316 +03:00 [INF] Request starting HTTP/2 POST https://localhost:5001/api/Auth/register - application/json 61
2025-07-12 17:03:10.320 +03:00 [INF] CORS policy execution successful.
2025-07-12 17:03:10.322 +03:00 [INF] Executing endpoint 'VendingMachine.API.Controllers.AuthController.Register (VendingMachine.API)'
2025-07-12 17:03:10.330 +03:00 [INF] Route matched with {action = "Register", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Register(VendingMachine.Core.DTOs.CreateUserDto) on controller VendingMachine.API.Controllers.AuthController (VendingMachine.API).
2025-07-12 17:03:10.344 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-07-12 17:03:10.358 +03:00 [INF] Executed action VendingMachine.API.Controllers.AuthController.Register (VendingMachine.API) in 25.6092ms
2025-07-12 17:03:10.360 +03:00 [INF] Executed endpoint 'VendingMachine.API.Controllers.AuthController.Register (VendingMachine.API)'
2025-07-12 17:03:10.361 +03:00 [INF] Request finished HTTP/2 POST https://localhost:5001/api/Auth/register - 400 null application/problem+json; charset=utf-8 44.1401ms
2025-07-12 17:03:19.743 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/Auth/register - application/json 63
2025-07-12 17:03:19.746 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/Auth/register - 307 0 null 3.054ms
2025-07-12 17:03:19.755 +03:00 [INF] Request starting HTTP/2 OPTIONS https://localhost:5001/api/Auth/register - null null
2025-07-12 17:03:19.758 +03:00 [INF] CORS policy execution successful.
2025-07-12 17:03:19.760 +03:00 [INF] Request finished HTTP/2 OPTIONS https://localhost:5001/api/Auth/register - 204 null null 4.6683ms
2025-07-12 17:03:19.767 +03:00 [INF] Request starting HTTP/2 POST https://localhost:5001/api/Auth/register - application/json 63
2025-07-12 17:03:19.771 +03:00 [INF] CORS policy execution successful.
2025-07-12 17:03:19.772 +03:00 [INF] Executing endpoint 'VendingMachine.API.Controllers.AuthController.Register (VendingMachine.API)'
2025-07-12 17:03:19.773 +03:00 [INF] Route matched with {action = "Register", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Register(VendingMachine.Core.DTOs.CreateUserDto) on controller VendingMachine.API.Controllers.AuthController (VendingMachine.API).
2025-07-12 17:03:19.808 +03:00 [INF] Executed DbCommand (11ms) [Parameters=[@__username_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Users] AS [u]
        WHERE [u].[Username] = @__username_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-07-12 17:03:19.881 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@p0='?' (DbType = DateTime2), @p1='?' (Precision = 18) (Scale = 2) (DbType = Decimal), @p2='?' (Size = 4000), @p3='?' (DbType = Int32), @p4='?' (DbType = DateTime2), @p5='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Users] ([CreatedAt], [Deposit], [PasswordHash], [Role], [UpdatedAt], [Username])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5);
2025-07-12 17:03:19.897 +03:00 [INF] Executing OkObjectResult, writing value of type 'VendingMachine.Core.DTOs.UserResponseDto'.
2025-07-12 17:03:19.899 +03:00 [INF] Executed action VendingMachine.API.Controllers.AuthController.Register (VendingMachine.API) in 124.3667ms
2025-07-12 17:03:19.900 +03:00 [INF] Executed endpoint 'VendingMachine.API.Controllers.AuthController.Register (VendingMachine.API)'
2025-07-12 17:03:19.902 +03:00 [INF] Request finished HTTP/2 POST https://localhost:5001/api/Auth/register - 200 null application/json; charset=utf-8 134.2262ms
2025-07-12 17:03:24.607 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/Auth/login - application/json 50
2025-07-12 17:03:24.609 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/Auth/login - 307 0 null 2.622ms
2025-07-12 17:03:24.613 +03:00 [INF] Request starting HTTP/2 OPTIONS https://localhost:5001/api/Auth/login - null null
2025-07-12 17:03:24.615 +03:00 [INF] CORS policy execution successful.
2025-07-12 17:03:24.616 +03:00 [INF] Request finished HTTP/2 OPTIONS https://localhost:5001/api/Auth/login - 204 null null 2.6396ms
2025-07-12 17:03:24.623 +03:00 [INF] Request starting HTTP/2 POST https://localhost:5001/api/Auth/login - application/json 50
2025-07-12 17:03:24.625 +03:00 [INF] CORS policy execution successful.
2025-07-12 17:03:24.627 +03:00 [INF] Executing endpoint 'VendingMachine.API.Controllers.AuthController.Login (VendingMachine.API)'
2025-07-12 17:03:24.628 +03:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(VendingMachine.API.Controllers.LoginDto) on controller VendingMachine.API.Controllers.AuthController (VendingMachine.API).
2025-07-12 17:03:24.670 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__username_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[Id], [u].[CreatedAt], [u].[Deposit], [u].[PasswordHash], [u].[Role], [u].[UpdatedAt], [u].[Username]
FROM [Users] AS [u]
WHERE [u].[Username] = @__username_0
2025-07-12 17:03:24.672 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType1`2[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[VendingMachine.Core.DTOs.UserResponseDto, VendingMachine.Core, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-12 17:03:24.673 +03:00 [INF] Executed action VendingMachine.API.Controllers.AuthController.Login (VendingMachine.API) in 44.0087ms
2025-07-12 17:03:24.674 +03:00 [INF] Executed endpoint 'VendingMachine.API.Controllers.AuthController.Login (VendingMachine.API)'
2025-07-12 17:03:24.675 +03:00 [INF] Request finished HTTP/2 POST https://localhost:5001/api/Auth/login - 200 null application/json; charset=utf-8 52.0831ms
2025-07-12 17:04:02.100 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/Products - application/json 70
2025-07-12 17:04:02.106 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/Products - 307 0 null 5.9128ms
2025-07-12 17:04:02.119 +03:00 [INF] Request starting HTTP/2 OPTIONS https://localhost:5001/api/Products - null null
2025-07-12 17:04:02.125 +03:00 [INF] CORS policy execution successful.
2025-07-12 17:04:02.128 +03:00 [INF] Request finished HTTP/2 OPTIONS https://localhost:5001/api/Products - 204 null null 8.2685ms
2025-07-12 17:04:02.131 +03:00 [INF] Request starting HTTP/2 POST https://localhost:5001/api/Products - application/json 70
2025-07-12 17:04:02.133 +03:00 [INF] CORS policy execution successful.
2025-07-12 17:04:02.137 +03:00 [INF] Authorization failed. These requirements were not met:
RolesAuthorizationRequirement:User.IsInRole must be true for one of the following roles: (Seller)
2025-07-12 17:04:02.139 +03:00 [INF] AuthenticationScheme: Bearer was challenged.
2025-07-12 17:04:02.140 +03:00 [INF] Request finished HTTP/2 POST https://localhost:5001/api/Products - 401 0 null 8.783ms
2025-07-12 17:09:24.910 +03:00 [INF] Application is shutting down...
2025-07-12 17:09:34.299 +03:00 [INF] User profile is available. Using 'C:\Users\osmohamed\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-07-12 17:09:34.474 +03:00 [INF] Now listening on: http://localhost:5000
2025-07-12 17:09:34.475 +03:00 [INF] Now listening on: https://localhost:5001
2025-07-12 17:09:34.477 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-07-12 17:09:34.478 +03:00 [INF] Hosting environment: Development
2025-07-12 17:09:34.479 +03:00 [INF] Content root path: C:\Users\osmohamed\Documents\Omar\Vending-machine\src\VendingMachine.API
2025-07-12 17:09:38.770 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/swagger/index.html - null null
2025-07-12 17:09:38.859 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5000/swagger/index.html - 200 null text/html;charset=utf-8 90.6939ms
2025-07-12 17:09:39.547 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/swagger/v1/swagger.json - null null
2025-07-12 17:09:39.730 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5000/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 182.559ms
2025-07-12 17:10:15.049 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/swagger/index.html - null null
2025-07-12 17:10:15.057 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5000/swagger/index.html - 200 null text/html;charset=utf-8 8.1576ms
2025-07-12 17:10:15.463 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/swagger/v1/swagger.json - null null
2025-07-12 17:10:15.483 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5000/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 20.029ms
2025-07-12 17:10:27.651 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/Auth/register - application/json 62
2025-07-12 17:10:27.660 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/Auth/register - 307 0 null 9.6528ms
2025-07-12 17:10:27.752 +03:00 [INF] Request starting HTTP/2 OPTIONS https://localhost:5001/api/Auth/register - null null
2025-07-12 17:10:27.758 +03:00 [INF] CORS policy execution successful.
2025-07-12 17:10:27.760 +03:00 [INF] Request finished HTTP/2 OPTIONS https://localhost:5001/api/Auth/register - 204 null null 8.1515ms
2025-07-12 17:10:27.770 +03:00 [INF] Request starting HTTP/2 POST https://localhost:5001/api/Auth/register - application/json 62
2025-07-12 17:10:27.772 +03:00 [INF] CORS policy execution successful.
2025-07-12 17:10:27.808 +03:00 [INF] Executing endpoint 'VendingMachine.API.Controllers.AuthController.Register (VendingMachine.API)'
2025-07-12 17:10:27.837 +03:00 [INF] Route matched with {action = "Register", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Register(VendingMachine.Core.DTOs.CreateUserDto) on controller VendingMachine.API.Controllers.AuthController (VendingMachine.API).
2025-07-12 17:10:29.092 +03:00 [INF] Executed DbCommand (37ms) [Parameters=[@__username_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Users] AS [u]
        WHERE [u].[Username] = @__username_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-07-12 17:10:29.266 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@p0='?' (DbType = DateTime2), @p1='?' (Precision = 18) (Scale = 2) (DbType = Decimal), @p2='?' (Size = 4000), @p3='?' (DbType = Int32), @p4='?' (DbType = DateTime2), @p5='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Users] ([CreatedAt], [Deposit], [PasswordHash], [Role], [UpdatedAt], [Username])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5);
2025-07-12 17:10:29.294 +03:00 [INF] Executing OkObjectResult, writing value of type 'VendingMachine.Core.DTOs.UserResponseDto'.
2025-07-12 17:10:29.313 +03:00 [INF] Executed action VendingMachine.API.Controllers.AuthController.Register (VendingMachine.API) in 1469.3021ms
2025-07-12 17:10:29.315 +03:00 [INF] Executed endpoint 'VendingMachine.API.Controllers.AuthController.Register (VendingMachine.API)'
2025-07-12 17:10:29.322 +03:00 [INF] Request finished HTTP/2 POST https://localhost:5001/api/Auth/register - 200 null application/json; charset=utf-8 1551.5364ms
2025-07-12 17:10:42.896 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/Auth/login - application/json 49
2025-07-12 17:10:42.902 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/Auth/login - 307 0 null 5.7485ms
2025-07-12 17:10:42.925 +03:00 [INF] Request starting HTTP/2 OPTIONS https://localhost:5001/api/Auth/login - null null
2025-07-12 17:10:42.937 +03:00 [INF] CORS policy execution successful.
2025-07-12 17:10:42.939 +03:00 [INF] Request finished HTTP/2 OPTIONS https://localhost:5001/api/Auth/login - 204 null null 13.9974ms
2025-07-12 17:10:42.942 +03:00 [INF] Request starting HTTP/2 POST https://localhost:5001/api/Auth/login - application/json 49
2025-07-12 17:10:42.945 +03:00 [INF] CORS policy execution successful.
2025-07-12 17:10:42.951 +03:00 [INF] Executing endpoint 'VendingMachine.API.Controllers.AuthController.Login (VendingMachine.API)'
2025-07-12 17:10:42.957 +03:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(VendingMachine.API.Controllers.LoginDto) on controller VendingMachine.API.Controllers.AuthController (VendingMachine.API).
2025-07-12 17:10:43.013 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__username_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[Id], [u].[CreatedAt], [u].[Deposit], [u].[PasswordHash], [u].[Role], [u].[UpdatedAt], [u].[Username]
FROM [Users] AS [u]
WHERE [u].[Username] = @__username_0
2025-07-12 17:10:43.052 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType1`2[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[VendingMachine.Core.DTOs.UserResponseDto, VendingMachine.Core, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-12 17:10:43.056 +03:00 [INF] Executed action VendingMachine.API.Controllers.AuthController.Login (VendingMachine.API) in 97.6672ms
2025-07-12 17:10:43.058 +03:00 [INF] Executed endpoint 'VendingMachine.API.Controllers.AuthController.Login (VendingMachine.API)'
2025-07-12 17:10:43.059 +03:00 [INF] Request finished HTTP/2 POST https://localhost:5001/api/Auth/login - 200 null application/json; charset=utf-8 117.2902ms
2025-07-12 17:11:24.813 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/Products - application/json 70
2025-07-12 17:11:24.817 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/Products - 307 0 null 4.5938ms
2025-07-12 17:11:24.829 +03:00 [INF] Request starting HTTP/2 OPTIONS https://localhost:5001/api/Products - null null
2025-07-12 17:11:24.834 +03:00 [INF] CORS policy execution successful.
2025-07-12 17:11:24.835 +03:00 [INF] Request finished HTTP/2 OPTIONS https://localhost:5001/api/Products - 204 null null 6.1104ms
2025-07-12 17:11:24.837 +03:00 [INF] Request starting HTTP/2 POST https://localhost:5001/api/Products - application/json 70
2025-07-12 17:11:24.841 +03:00 [INF] CORS policy execution successful.
2025-07-12 17:11:24.852 +03:00 [INF] Authorization failed. These requirements were not met:
RolesAuthorizationRequirement:User.IsInRole must be true for one of the following roles: (Seller)
2025-07-12 17:11:24.856 +03:00 [INF] AuthenticationScheme: Bearer was challenged.
2025-07-12 17:11:24.857 +03:00 [INF] Request finished HTTP/2 POST https://localhost:5001/api/Products - 401 0 null 19.7158ms
2025-07-12 17:12:59.321 +03:00 [INF] Application is shutting down...
2025-07-12 17:13:05.395 +03:00 [INF] User profile is available. Using 'C:\Users\osmohamed\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-07-12 17:13:05.530 +03:00 [INF] Now listening on: http://localhost:5000
2025-07-12 17:13:05.531 +03:00 [INF] Now listening on: https://localhost:5001
2025-07-12 17:13:05.534 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-07-12 17:13:05.535 +03:00 [INF] Hosting environment: Development
2025-07-12 17:13:05.536 +03:00 [INF] Content root path: C:\Users\osmohamed\Documents\Omar\Vending-machine\src\VendingMachine.API
2025-07-12 17:13:12.876 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/swagger/index.html - null null
2025-07-12 17:13:12.936 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5000/swagger/index.html - 200 null text/html;charset=utf-8 60.3112ms
2025-07-12 17:13:13.092 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/swagger/v1/swagger.json - null null
2025-07-12 17:13:13.244 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5000/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 152.5812ms
2025-07-12 17:13:25.646 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/Auth/login - application/json 49
2025-07-12 17:13:25.655 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/Auth/login - 307 0 null 8.3693ms
2025-07-12 17:13:25.732 +03:00 [INF] Request starting HTTP/2 OPTIONS https://localhost:5001/api/Auth/login - null null
2025-07-12 17:13:25.738 +03:00 [INF] CORS policy execution successful.
2025-07-12 17:13:25.740 +03:00 [INF] Request finished HTTP/2 OPTIONS https://localhost:5001/api/Auth/login - 204 null null 7.3862ms
2025-07-12 17:13:25.749 +03:00 [INF] Request starting HTTP/2 POST https://localhost:5001/api/Auth/login - application/json 49
2025-07-12 17:13:25.752 +03:00 [INF] CORS policy execution successful.
2025-07-12 17:13:25.783 +03:00 [INF] Executing endpoint 'VendingMachine.API.Controllers.AuthController.Login (VendingMachine.API)'
2025-07-12 17:13:25.803 +03:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(VendingMachine.API.Controllers.LoginDto) on controller VendingMachine.API.Controllers.AuthController (VendingMachine.API).
2025-07-12 17:13:26.965 +03:00 [INF] Executed DbCommand (40ms) [Parameters=[@__username_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[Id], [u].[CreatedAt], [u].[Deposit], [u].[PasswordHash], [u].[Role], [u].[UpdatedAt], [u].[Username]
FROM [Users] AS [u]
WHERE [u].[Username] = @__username_0
2025-07-12 17:13:27.087 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType1`2[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[VendingMachine.Core.DTOs.UserResponseDto, VendingMachine.Core, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-12 17:13:27.112 +03:00 [INF] Executed action VendingMachine.API.Controllers.AuthController.Login (VendingMachine.API) in 1302.2461ms
2025-07-12 17:13:27.115 +03:00 [INF] Executed endpoint 'VendingMachine.API.Controllers.AuthController.Login (VendingMachine.API)'
2025-07-12 17:13:27.123 +03:00 [INF] Request finished HTTP/2 POST https://localhost:5001/api/Auth/login - 200 null application/json; charset=utf-8 1373.2756ms
2025-07-12 17:13:48.206 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/Products - application/json 66
2025-07-12 17:13:48.218 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/Products - 307 0 null 11.7885ms
2025-07-12 17:13:48.241 +03:00 [INF] Request starting HTTP/2 OPTIONS https://localhost:5001/api/Products - null null
2025-07-12 17:13:48.246 +03:00 [INF] CORS policy execution successful.
2025-07-12 17:13:48.248 +03:00 [INF] Request finished HTTP/2 OPTIONS https://localhost:5001/api/Products - 204 null null 6.2408ms
2025-07-12 17:13:48.254 +03:00 [INF] Request starting HTTP/2 POST https://localhost:5001/api/Products - application/json 66
2025-07-12 17:13:48.257 +03:00 [INF] CORS policy execution successful.
2025-07-12 17:13:48.265 +03:00 [INF] Authorization failed. These requirements were not met:
RolesAuthorizationRequirement:User.IsInRole must be true for one of the following roles: (Seller)
2025-07-12 17:13:48.269 +03:00 [INF] AuthenticationScheme: Bearer was challenged.
2025-07-12 17:13:48.270 +03:00 [INF] Request finished HTTP/2 POST https://localhost:5001/api/Products - 401 0 null 15.4261ms
2025-07-12 17:15:55.884 +03:00 [INF] Application is shutting down...
2025-07-12 17:16:04.198 +03:00 [INF] User profile is available. Using 'C:\Users\osmohamed\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-07-12 17:16:04.342 +03:00 [INF] Now listening on: http://localhost:5000
2025-07-12 17:16:04.343 +03:00 [INF] Now listening on: https://localhost:5001
2025-07-12 17:16:04.346 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-07-12 17:16:04.347 +03:00 [INF] Hosting environment: Development
2025-07-12 17:16:04.348 +03:00 [INF] Content root path: C:\Users\osmohamed\Documents\Omar\Vending-machine\src\VendingMachine.API
2025-07-12 17:16:12.243 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/swagger/index.html - null null
2025-07-12 17:16:12.337 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5000/swagger/index.html - 200 null text/html;charset=utf-8 94.7852ms
2025-07-12 17:16:12.933 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/swagger/v1/swagger.json - null null
2025-07-12 17:16:13.127 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5000/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 194.8057ms
2025-07-12 17:16:24.882 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/Auth/register - application/json 62
2025-07-12 17:16:24.914 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/Auth/register - 307 0 null 31.7278ms
2025-07-12 17:16:25.009 +03:00 [INF] Request starting HTTP/2 OPTIONS https://localhost:5001/api/Auth/register - null null
2025-07-12 17:16:25.016 +03:00 [INF] CORS policy execution successful.
2025-07-12 17:16:25.018 +03:00 [INF] Request finished HTTP/2 OPTIONS https://localhost:5001/api/Auth/register - 204 null null 8.8169ms
2025-07-12 17:16:25.029 +03:00 [INF] Request starting HTTP/2 POST https://localhost:5001/api/Auth/register - application/json 62
2025-07-12 17:16:25.032 +03:00 [INF] CORS policy execution successful.
2025-07-12 17:16:25.071 +03:00 [INF] Executing endpoint 'VendingMachine.API.Controllers.AuthController.Register (VendingMachine.API)'
2025-07-12 17:16:25.101 +03:00 [INF] Route matched with {action = "Register", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Register(VendingMachine.Core.DTOs.CreateUserDto) on controller VendingMachine.API.Controllers.AuthController (VendingMachine.API).
2025-07-12 17:16:26.437 +03:00 [INF] Executed DbCommand (46ms) [Parameters=[@__username_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Users] AS [u]
        WHERE [u].[Username] = @__username_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-07-12 17:16:26.609 +03:00 [INF] Executed DbCommand (11ms) [Parameters=[@p0='?' (DbType = DateTime2), @p1='?' (Precision = 18) (Scale = 2) (DbType = Decimal), @p2='?' (Size = 4000), @p3='?' (DbType = Int32), @p4='?' (DbType = DateTime2), @p5='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Users] ([CreatedAt], [Deposit], [PasswordHash], [Role], [UpdatedAt], [Username])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5);
2025-07-12 17:16:26.638 +03:00 [INF] Executing OkObjectResult, writing value of type 'VendingMachine.Core.DTOs.UserResponseDto'.
2025-07-12 17:16:26.656 +03:00 [INF] Executed action VendingMachine.API.Controllers.AuthController.Register (VendingMachine.API) in 1550.6762ms
2025-07-12 17:16:26.660 +03:00 [INF] Executed endpoint 'VendingMachine.API.Controllers.AuthController.Register (VendingMachine.API)'
2025-07-12 17:16:26.667 +03:00 [INF] Request finished HTTP/2 POST https://localhost:5001/api/Auth/register - 200 null application/json; charset=utf-8 1637.117ms
2025-07-12 17:16:37.046 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/Auth/login - application/json 49
2025-07-12 17:16:37.050 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/Auth/login - 307 0 null 3.56ms
2025-07-12 17:16:37.063 +03:00 [INF] Request starting HTTP/2 OPTIONS https://localhost:5001/api/Auth/login - null null
2025-07-12 17:16:37.066 +03:00 [INF] CORS policy execution successful.
2025-07-12 17:16:37.067 +03:00 [INF] Request finished HTTP/2 OPTIONS https://localhost:5001/api/Auth/login - 204 null null 3.8948ms
2025-07-12 17:16:37.069 +03:00 [INF] Request starting HTTP/2 POST https://localhost:5001/api/Auth/login - application/json 49
2025-07-12 17:16:37.071 +03:00 [INF] CORS policy execution successful.
2025-07-12 17:16:37.073 +03:00 [INF] Executing endpoint 'VendingMachine.API.Controllers.AuthController.Login (VendingMachine.API)'
2025-07-12 17:16:37.082 +03:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(VendingMachine.API.Controllers.LoginDto) on controller VendingMachine.API.Controllers.AuthController (VendingMachine.API).
2025-07-12 17:16:37.143 +03:00 [INF] Executed DbCommand (10ms) [Parameters=[@__username_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[Id], [u].[CreatedAt], [u].[Deposit], [u].[PasswordHash], [u].[Role], [u].[UpdatedAt], [u].[Username]
FROM [Users] AS [u]
WHERE [u].[Username] = @__username_0
2025-07-12 17:16:37.179 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType1`2[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[VendingMachine.Core.DTOs.UserResponseDto, VendingMachine.Core, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-12 17:16:37.183 +03:00 [INF] Executed action VendingMachine.API.Controllers.AuthController.Login (VendingMachine.API) in 98.7036ms
2025-07-12 17:16:37.184 +03:00 [INF] Executed endpoint 'VendingMachine.API.Controllers.AuthController.Login (VendingMachine.API)'
2025-07-12 17:16:37.185 +03:00 [INF] Request finished HTTP/2 POST https://localhost:5001/api/Auth/login - 200 null application/json; charset=utf-8 115.8955ms
2025-07-12 17:16:56.583 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/api/Auth/user/3 - null null
2025-07-12 17:16:56.587 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5000/api/Auth/user/3 - 307 0 null 3.892ms
2025-07-12 17:16:56.591 +03:00 [INF] Request starting HTTP/2 GET https://localhost:5001/api/Auth/user/3 - null null
2025-07-12 17:16:56.598 +03:00 [INF] CORS policy execution successful.
2025-07-12 17:16:56.600 +03:00 [INF] Executing endpoint 'VendingMachine.API.Controllers.AuthController.GetUser (VendingMachine.API)'
2025-07-12 17:16:56.605 +03:00 [INF] Route matched with {action = "GetUser", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetUser(Int32) on controller VendingMachine.API.Controllers.AuthController (VendingMachine.API).
2025-07-12 17:16:56.664 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__username_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[Id], [u].[CreatedAt], [u].[Deposit], [u].[PasswordHash], [u].[Role], [u].[UpdatedAt], [u].[Username]
FROM [Users] AS [u]
WHERE [u].[Username] = @__username_0
2025-07-12 17:16:56.667 +03:00 [INF] Executing NotFoundObjectResult, writing value of type '<>f__AnonymousType0`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-12 17:16:56.669 +03:00 [INF] Executed action VendingMachine.API.Controllers.AuthController.GetUser (VendingMachine.API) in 62.555ms
2025-07-12 17:16:56.671 +03:00 [INF] Executed endpoint 'VendingMachine.API.Controllers.AuthController.GetUser (VendingMachine.API)'
2025-07-12 17:16:56.672 +03:00 [INF] Request finished HTTP/2 GET https://localhost:5001/api/Auth/user/3 - 404 null application/json; charset=utf-8 80.8914ms
2025-07-12 17:17:04.167 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/api/Auth/user/4 - null null
2025-07-12 17:17:04.171 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5000/api/Auth/user/4 - 307 0 null 4.1014ms
2025-07-12 17:17:04.182 +03:00 [INF] Request starting HTTP/2 GET https://localhost:5001/api/Auth/user/4 - null null
2025-07-12 17:17:04.185 +03:00 [INF] CORS policy execution successful.
2025-07-12 17:17:04.190 +03:00 [INF] Executing endpoint 'VendingMachine.API.Controllers.AuthController.GetUser (VendingMachine.API)'
2025-07-12 17:17:04.193 +03:00 [INF] Route matched with {action = "GetUser", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetUser(Int32) on controller VendingMachine.API.Controllers.AuthController (VendingMachine.API).
2025-07-12 17:17:04.211 +03:00 [INF] Executed DbCommand (13ms) [Parameters=[@__username_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[Id], [u].[CreatedAt], [u].[Deposit], [u].[PasswordHash], [u].[Role], [u].[UpdatedAt], [u].[Username]
FROM [Users] AS [u]
WHERE [u].[Username] = @__username_0
2025-07-12 17:17:04.214 +03:00 [INF] Executing NotFoundObjectResult, writing value of type '<>f__AnonymousType0`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-12 17:17:04.216 +03:00 [INF] Executed action VendingMachine.API.Controllers.AuthController.GetUser (VendingMachine.API) in 19.9609ms
2025-07-12 17:17:04.217 +03:00 [INF] Executed endpoint 'VendingMachine.API.Controllers.AuthController.GetUser (VendingMachine.API)'
2025-07-12 17:17:04.218 +03:00 [INF] Request finished HTTP/2 GET https://localhost:5001/api/Auth/user/4 - 404 null application/json; charset=utf-8 36.5855ms
2025-07-12 17:17:09.422 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/api/Auth/user/4 - null null
2025-07-12 17:17:09.426 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5000/api/Auth/user/4 - 307 0 null 4.071ms
2025-07-12 17:17:09.429 +03:00 [INF] Request starting HTTP/2 GET https://localhost:5001/api/Auth/user/4 - null null
2025-07-12 17:17:09.433 +03:00 [INF] CORS policy execution successful.
2025-07-12 17:17:09.435 +03:00 [INF] Executing endpoint 'VendingMachine.API.Controllers.AuthController.GetUser (VendingMachine.API)'
2025-07-12 17:17:09.436 +03:00 [INF] Route matched with {action = "GetUser", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetUser(Int32) on controller VendingMachine.API.Controllers.AuthController (VendingMachine.API).
2025-07-12 17:17:09.442 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__username_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[Id], [u].[CreatedAt], [u].[Deposit], [u].[PasswordHash], [u].[Role], [u].[UpdatedAt], [u].[Username]
FROM [Users] AS [u]
WHERE [u].[Username] = @__username_0
2025-07-12 17:17:09.445 +03:00 [INF] Executing NotFoundObjectResult, writing value of type '<>f__AnonymousType0`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-12 17:17:09.446 +03:00 [INF] Executed action VendingMachine.API.Controllers.AuthController.GetUser (VendingMachine.API) in 9.2533ms
2025-07-12 17:17:09.448 +03:00 [INF] Executed endpoint 'VendingMachine.API.Controllers.AuthController.GetUser (VendingMachine.API)'
2025-07-12 17:17:09.449 +03:00 [INF] Request finished HTTP/2 GET https://localhost:5001/api/Auth/user/4 - 404 null application/json; charset=utf-8 19.3485ms
2025-07-12 17:17:20.452 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/Products - application/json 75
2025-07-12 17:17:20.455 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/Products - 307 0 null 3.5607ms
2025-07-12 17:17:20.458 +03:00 [INF] Request starting HTTP/2 OPTIONS https://localhost:5001/api/Products - null null
2025-07-12 17:17:20.462 +03:00 [INF] CORS policy execution successful.
2025-07-12 17:17:20.464 +03:00 [INF] Request finished HTTP/2 OPTIONS https://localhost:5001/api/Products - 204 null null 5.3225ms
2025-07-12 17:17:20.467 +03:00 [INF] Request starting HTTP/2 POST https://localhost:5001/api/Products - application/json 75
2025-07-12 17:17:20.468 +03:00 [INF] CORS policy execution successful.
2025-07-12 17:17:20.474 +03:00 [INF] Authorization failed. These requirements were not met:
RolesAuthorizationRequirement:User.IsInRole must be true for one of the following roles: (Seller)
2025-07-12 17:17:20.478 +03:00 [INF] AuthenticationScheme: Bearer was challenged.
2025-07-12 17:17:20.479 +03:00 [INF] Request finished HTTP/2 POST https://localhost:5001/api/Products - 401 0 null 11.976ms
2025-07-12 17:22:09.426 +03:00 [INF] User profile is available. Using 'C:\Users\osmohamed\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-07-12 17:22:09.530 +03:00 [INF] Now listening on: http://localhost:5000
2025-07-12 17:22:09.533 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-07-12 17:22:09.535 +03:00 [INF] Hosting environment: Development
2025-07-12 17:22:09.537 +03:00 [INF] Content root path: C:\Users\osmohamed\Documents\Omar\Vending-machine\src\VendingMachine.API
2025-07-12 17:22:14.306 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/swagger/index.html - null null
2025-07-12 17:22:14.393 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5000/swagger/index.html - 200 null text/html;charset=utf-8 89.5812ms
2025-07-12 17:22:15.019 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/swagger/v1/swagger.json - null null
2025-07-12 17:22:15.222 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5000/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 203.3343ms
2025-07-12 17:22:33.246 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/Auth/login - application/json 49
2025-07-12 17:22:33.260 +03:00 [WRN] Failed to determine the https port for redirect.
2025-07-12 17:22:33.265 +03:00 [INF] CORS policy execution successful.
2025-07-12 17:22:33.314 +03:00 [INF] Executing endpoint 'VendingMachine.API.Controllers.AuthController.Login (VendingMachine.API)'
2025-07-12 17:22:33.345 +03:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(VendingMachine.API.Controllers.LoginDto) on controller VendingMachine.API.Controllers.AuthController (VendingMachine.API).
2025-07-12 17:22:34.708 +03:00 [INF] Executed DbCommand (42ms) [Parameters=[@__username_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[Id], [u].[CreatedAt], [u].[Deposit], [u].[PasswordHash], [u].[Role], [u].[UpdatedAt], [u].[Username]
FROM [Users] AS [u]
WHERE [u].[Username] = @__username_0
2025-07-12 17:22:34.811 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType1`2[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[VendingMachine.Core.DTOs.UserResponseDto, VendingMachine.Core, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-12 17:22:34.833 +03:00 [INF] Executed action VendingMachine.API.Controllers.AuthController.Login (VendingMachine.API) in 1481.4489ms
2025-07-12 17:22:34.835 +03:00 [INF] Executed endpoint 'VendingMachine.API.Controllers.AuthController.Login (VendingMachine.API)'
2025-07-12 17:22:34.843 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/Auth/login - 200 null application/json; charset=utf-8 1597.5162ms
2025-07-12 17:22:48.361 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/Products - application/json 66
2025-07-12 17:22:48.367 +03:00 [INF] CORS policy execution successful.
2025-07-12 17:22:48.414 +03:00 [INF] Authorization failed. These requirements were not met:
RolesAuthorizationRequirement:User.IsInRole must be true for one of the following roles: (Seller)
2025-07-12 17:22:48.418 +03:00 [INF] AuthenticationScheme: Bearer was forbidden.
2025-07-12 17:22:48.421 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/Products - 403 0 null 60.4425ms
2025-07-12 17:26:43.248 +03:00 [INF] Application is shutting down...
2025-07-12 17:26:50.914 +03:00 [INF] User profile is available. Using 'C:\Users\osmohamed\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-07-12 17:26:51.002 +03:00 [INF] Now listening on: http://localhost:5000
2025-07-12 17:26:51.005 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-07-12 17:26:51.006 +03:00 [INF] Hosting environment: Development
2025-07-12 17:26:51.008 +03:00 [INF] Content root path: C:\Users\osmohamed\Documents\Omar\Vending-machine\src\VendingMachine.API
2025-07-12 17:26:59.885 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/swagger/index.html - null null
2025-07-12 17:26:59.954 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5000/swagger/index.html - 200 null text/html;charset=utf-8 70.4206ms
2025-07-12 17:27:00.566 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/swagger/v1/swagger.json - null null
2025-07-12 17:27:00.713 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5000/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 147.3016ms
2025-07-12 17:27:11.227 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/Auth/login - application/json 49
2025-07-12 17:27:11.236 +03:00 [WRN] Failed to determine the https port for redirect.
2025-07-12 17:27:11.239 +03:00 [INF] CORS policy execution successful.
2025-07-12 17:27:11.284 +03:00 [INF] Executing endpoint 'VendingMachine.API.Controllers.AuthController.Login (VendingMachine.API)'
2025-07-12 17:27:11.304 +03:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(VendingMachine.API.Controllers.LoginDto) on controller VendingMachine.API.Controllers.AuthController (VendingMachine.API).
2025-07-12 17:27:12.518 +03:00 [INF] Executed DbCommand (37ms) [Parameters=[@__username_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[Id], [u].[CreatedAt], [u].[Deposit], [u].[PasswordHash], [u].[Role], [u].[UpdatedAt], [u].[Username]
FROM [Users] AS [u]
WHERE [u].[Username] = @__username_0
2025-07-12 17:27:12.619 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType1`2[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[VendingMachine.Core.DTOs.UserResponseDto, VendingMachine.Core, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-12 17:27:12.638 +03:00 [INF] Executed action VendingMachine.API.Controllers.AuthController.Login (VendingMachine.API) in 1328.3832ms
2025-07-12 17:27:12.641 +03:00 [INF] Executed endpoint 'VendingMachine.API.Controllers.AuthController.Login (VendingMachine.API)'
2025-07-12 17:27:12.647 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/Auth/login - 200 null application/json; charset=utf-8 1420.5957ms
2025-07-12 17:27:24.234 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/Products - application/json 75
2025-07-12 17:27:24.240 +03:00 [INF] CORS policy execution successful.
2025-07-12 17:27:24.280 +03:00 [INF] Authorization failed. These requirements were not met:
RolesAuthorizationRequirement:User.IsInRole must be true for one of the following roles: (Seller)
2025-07-12 17:27:24.287 +03:00 [INF] AuthenticationScheme: Bearer was forbidden.
2025-07-12 17:27:24.289 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/Products - 403 0 null 54.8317ms
2025-07-12 17:28:17.139 +03:00 [INF] Application is shutting down...
2025-07-12 17:28:22.393 +03:00 [INF] User profile is available. Using 'C:\Users\osmohamed\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-07-12 17:28:22.481 +03:00 [INF] Now listening on: http://localhost:5000
2025-07-12 17:28:22.484 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-07-12 17:28:22.486 +03:00 [INF] Hosting environment: Development
2025-07-12 17:28:22.487 +03:00 [INF] Content root path: C:\Users\osmohamed\Documents\Omar\Vending-machine\src\VendingMachine.API
2025-07-12 17:28:32.785 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/swagger/index.html - null null
2025-07-12 17:28:32.884 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5000/swagger/index.html - 200 null text/html;charset=utf-8 99.8674ms
2025-07-12 17:28:33.657 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/swagger/v1/swagger.json - null null
2025-07-12 17:28:33.877 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5000/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 220.5113ms
2025-07-12 17:28:50.966 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/Auth/register - application/json 63
2025-07-12 17:28:50.975 +03:00 [WRN] Failed to determine the https port for redirect.
2025-07-12 17:28:50.977 +03:00 [INF] CORS policy execution successful.
2025-07-12 17:28:51.012 +03:00 [INF] Executing endpoint 'VendingMachine.API.Controllers.AuthController.Register (VendingMachine.API)'
2025-07-12 17:28:51.033 +03:00 [INF] Route matched with {action = "Register", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Register(VendingMachine.Core.DTOs.CreateUserDto) on controller VendingMachine.API.Controllers.AuthController (VendingMachine.API).
2025-07-12 17:28:52.178 +03:00 [INF] Executed DbCommand (41ms) [Parameters=[@__username_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Users] AS [u]
        WHERE [u].[Username] = @__username_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-07-12 17:28:52.384 +03:00 [INF] Executed DbCommand (20ms) [Parameters=[@p0='?' (DbType = DateTime2), @p1='?' (Precision = 18) (Scale = 2) (DbType = Decimal), @p2='?' (Size = 4000), @p3='?' (DbType = Int32), @p4='?' (DbType = DateTime2), @p5='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Users] ([CreatedAt], [Deposit], [PasswordHash], [Role], [UpdatedAt], [Username])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5);
2025-07-12 17:28:52.416 +03:00 [INF] Executing OkObjectResult, writing value of type 'VendingMachine.Core.DTOs.UserResponseDto'.
2025-07-12 17:28:52.434 +03:00 [INF] Executed action VendingMachine.API.Controllers.AuthController.Register (VendingMachine.API) in 1394.3749ms
2025-07-12 17:28:52.436 +03:00 [INF] Executed endpoint 'VendingMachine.API.Controllers.AuthController.Register (VendingMachine.API)'
2025-07-12 17:28:52.445 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/Auth/register - 200 null application/json; charset=utf-8 1478.5885ms
2025-07-12 17:28:59.009 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/Auth/login - application/json 53
2025-07-12 17:28:59.014 +03:00 [INF] CORS policy execution successful.
2025-07-12 17:28:59.016 +03:00 [INF] Executing endpoint 'VendingMachine.API.Controllers.AuthController.Login (VendingMachine.API)'
2025-07-12 17:28:59.024 +03:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(VendingMachine.API.Controllers.LoginDto) on controller VendingMachine.API.Controllers.AuthController (VendingMachine.API).
2025-07-12 17:28:59.038 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-07-12 17:28:59.053 +03:00 [INF] Executed action VendingMachine.API.Controllers.AuthController.Login (VendingMachine.API) in 27.5317ms
2025-07-12 17:28:59.055 +03:00 [INF] Executed endpoint 'VendingMachine.API.Controllers.AuthController.Login (VendingMachine.API)'
2025-07-12 17:28:59.056 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/Auth/login - 400 null application/problem+json; charset=utf-8 47.3133ms
2025-07-12 17:29:12.682 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/Auth/login - application/json 50
2025-07-12 17:29:12.686 +03:00 [INF] CORS policy execution successful.
2025-07-12 17:29:12.688 +03:00 [INF] Executing endpoint 'VendingMachine.API.Controllers.AuthController.Login (VendingMachine.API)'
2025-07-12 17:29:12.689 +03:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(VendingMachine.API.Controllers.LoginDto) on controller VendingMachine.API.Controllers.AuthController (VendingMachine.API).
2025-07-12 17:29:12.752 +03:00 [INF] Executed DbCommand (9ms) [Parameters=[@__username_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[Id], [u].[CreatedAt], [u].[Deposit], [u].[PasswordHash], [u].[Role], [u].[UpdatedAt], [u].[Username]
FROM [Users] AS [u]
WHERE [u].[Username] = @__username_0
2025-07-12 17:29:12.801 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType1`2[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[VendingMachine.Core.DTOs.UserResponseDto, VendingMachine.Core, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-12 17:29:12.808 +03:00 [INF] Executed action VendingMachine.API.Controllers.AuthController.Login (VendingMachine.API) in 117.1782ms
2025-07-12 17:29:12.810 +03:00 [INF] Executed endpoint 'VendingMachine.API.Controllers.AuthController.Login (VendingMachine.API)'
2025-07-12 17:29:12.811 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/Auth/login - 200 null application/json; charset=utf-8 128.9653ms
2025-07-12 17:29:25.960 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/Products - application/json 75
2025-07-12 17:29:25.963 +03:00 [INF] CORS policy execution successful.
2025-07-12 17:29:26.003 +03:00 [INF] Authorization failed. These requirements were not met:
RolesAuthorizationRequirement:User.IsInRole must be true for one of the following roles: (Seller)
2025-07-12 17:29:26.007 +03:00 [INF] AuthenticationScheme: Bearer was forbidden.
2025-07-12 17:29:26.008 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/Products - 403 0 null 47.8908ms
2025-07-12 17:31:52.010 +03:00 [INF] Application is shutting down...
2025-07-12 17:32:02.760 +03:00 [INF] User profile is available. Using 'C:\Users\osmohamed\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-07-12 17:32:02.842 +03:00 [INF] Now listening on: http://localhost:5000
2025-07-12 17:32:02.845 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-07-12 17:32:02.847 +03:00 [INF] Hosting environment: Development
2025-07-12 17:32:02.848 +03:00 [INF] Content root path: C:\Users\osmohamed\Documents\Omar\Vending-machine\src\VendingMachine.API
2025-07-12 17:32:09.021 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/swagger/index.html - null null
2025-07-12 17:32:09.175 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5000/swagger/index.html - 200 null text/html;charset=utf-8 153.7434ms
2025-07-12 17:32:10.261 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/swagger/v1/swagger.json - null null
2025-07-12 17:32:10.444 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5000/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 182.4149ms
2025-07-12 17:32:22.161 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/Auth/register - application/json 62
2025-07-12 17:32:22.172 +03:00 [WRN] Failed to determine the https port for redirect.
2025-07-12 17:32:22.174 +03:00 [INF] CORS policy execution successful.
2025-07-12 17:32:22.216 +03:00 [INF] Executing endpoint 'VendingMachine.API.Controllers.AuthController.Register (VendingMachine.API)'
2025-07-12 17:32:22.244 +03:00 [INF] Route matched with {action = "Register", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Register(VendingMachine.Core.DTOs.CreateUserDto) on controller VendingMachine.API.Controllers.AuthController (VendingMachine.API).
2025-07-12 17:32:23.483 +03:00 [INF] Executed DbCommand (41ms) [Parameters=[@__username_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Users] AS [u]
        WHERE [u].[Username] = @__username_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-07-12 17:32:23.659 +03:00 [INF] Executed DbCommand (12ms) [Parameters=[@p0='?' (DbType = DateTime2), @p1='?' (Precision = 18) (Scale = 2) (DbType = Decimal), @p2='?' (Size = 4000), @p3='?' (DbType = Int32), @p4='?' (DbType = DateTime2), @p5='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Users] ([CreatedAt], [Deposit], [PasswordHash], [Role], [UpdatedAt], [Username])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5);
2025-07-12 17:32:23.678 +03:00 [INF] Executing OkObjectResult, writing value of type 'VendingMachine.Core.DTOs.UserResponseDto'.
2025-07-12 17:32:23.696 +03:00 [INF] Executed action VendingMachine.API.Controllers.AuthController.Register (VendingMachine.API) in 1444.3885ms
2025-07-12 17:32:23.698 +03:00 [INF] Executed endpoint 'VendingMachine.API.Controllers.AuthController.Register (VendingMachine.API)'
2025-07-12 17:32:23.704 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/Auth/register - 200 null application/json; charset=utf-8 1543.3209ms
2025-07-12 17:32:33.637 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/Auth/login - application/json 49
2025-07-12 17:32:33.642 +03:00 [INF] CORS policy execution successful.
2025-07-12 17:32:33.643 +03:00 [INF] Executing endpoint 'VendingMachine.API.Controllers.AuthController.Login (VendingMachine.API)'
2025-07-12 17:32:33.650 +03:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(VendingMachine.API.Controllers.LoginDto) on controller VendingMachine.API.Controllers.AuthController (VendingMachine.API).
2025-07-12 17:32:33.713 +03:00 [INF] Executed DbCommand (9ms) [Parameters=[@__username_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[Id], [u].[CreatedAt], [u].[Deposit], [u].[PasswordHash], [u].[Role], [u].[UpdatedAt], [u].[Username]
FROM [Users] AS [u]
WHERE [u].[Username] = @__username_0
2025-07-12 17:32:33.751 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType1`2[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[VendingMachine.Core.DTOs.UserResponseDto, VendingMachine.Core, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-12 17:32:33.756 +03:00 [INF] Executed action VendingMachine.API.Controllers.AuthController.Login (VendingMachine.API) in 104.3878ms
2025-07-12 17:32:33.757 +03:00 [INF] Executed endpoint 'VendingMachine.API.Controllers.AuthController.Login (VendingMachine.API)'
2025-07-12 17:32:33.759 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/Auth/login - 200 null application/json; charset=utf-8 121.2702ms
2025-07-12 17:32:51.829 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/Products - application/json 75
2025-07-12 17:32:51.833 +03:00 [INF] CORS policy execution successful.
2025-07-12 17:32:51.875 +03:00 [INF] Authorization failed. These requirements were not met:
RolesAuthorizationRequirement:User.IsInRole must be true for one of the following roles: (Seller)
2025-07-12 17:32:51.881 +03:00 [INF] AuthenticationScheme: Bearer was forbidden.
2025-07-12 17:32:51.883 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/Products - 403 0 null 54.4159ms
2025-07-12 17:36:04.775 +03:00 [INF] Application is shutting down...
2025-07-12 17:36:14.165 +03:00 [INF] User profile is available. Using 'C:\Users\osmohamed\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-07-12 17:36:14.244 +03:00 [INF] Now listening on: http://localhost:5000
2025-07-12 17:36:14.248 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-07-12 17:36:14.250 +03:00 [INF] Hosting environment: Development
2025-07-12 17:36:14.251 +03:00 [INF] Content root path: C:\Users\osmohamed\Documents\Omar\Vending-machine\src\VendingMachine.API
2025-07-12 17:36:17.539 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/swagger/index.html - null null
2025-07-12 17:36:17.835 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5000/swagger/index.html - 200 null text/html;charset=utf-8 299.8232ms
2025-07-12 17:36:18.729 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/swagger/v1/swagger.json - null null
2025-07-12 17:36:18.939 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5000/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 209.6744ms
2025-07-12 17:36:32.299 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/Auth/register - application/json 62
2025-07-12 17:36:32.312 +03:00 [WRN] Failed to determine the https port for redirect.
2025-07-12 17:36:32.316 +03:00 [INF] CORS policy execution successful.
2025-07-12 17:36:32.364 +03:00 [INF] Executing endpoint 'VendingMachine.API.Controllers.AuthController.Register (VendingMachine.API)'
2025-07-12 17:36:32.389 +03:00 [INF] Route matched with {action = "Register", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Register(VendingMachine.Core.DTOs.CreateUserDto) on controller VendingMachine.API.Controllers.AuthController (VendingMachine.API).
2025-07-12 17:36:33.716 +03:00 [INF] Executed DbCommand (42ms) [Parameters=[@__username_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Users] AS [u]
        WHERE [u].[Username] = @__username_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-07-12 17:36:33.890 +03:00 [INF] Executed DbCommand (10ms) [Parameters=[@p0='?' (DbType = DateTime2), @p1='?' (Precision = 18) (Scale = 2) (DbType = Decimal), @p2='?' (Size = 4000), @p3='?' (DbType = Int32), @p4='?' (DbType = DateTime2), @p5='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Users] ([CreatedAt], [Deposit], [PasswordHash], [Role], [UpdatedAt], [Username])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5);
2025-07-12 17:36:33.920 +03:00 [INF] Executing OkObjectResult, writing value of type 'VendingMachine.Core.DTOs.UserResponseDto'.
2025-07-12 17:36:33.935 +03:00 [INF] Executed action VendingMachine.API.Controllers.AuthController.Register (VendingMachine.API) in 1540.0058ms
2025-07-12 17:36:33.937 +03:00 [INF] Executed endpoint 'VendingMachine.API.Controllers.AuthController.Register (VendingMachine.API)'
2025-07-12 17:36:33.946 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/Auth/register - 200 null application/json; charset=utf-8 1646.3907ms
2025-07-12 17:36:48.202 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/Auth/login - application/json 49
2025-07-12 17:36:48.218 +03:00 [INF] CORS policy execution successful.
2025-07-12 17:36:48.231 +03:00 [INF] Executing endpoint 'VendingMachine.API.Controllers.AuthController.Login (VendingMachine.API)'
2025-07-12 17:36:48.246 +03:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(VendingMachine.API.Controllers.LoginDto) on controller VendingMachine.API.Controllers.AuthController (VendingMachine.API).
2025-07-12 17:36:48.263 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-07-12 17:36:48.278 +03:00 [INF] Executed action VendingMachine.API.Controllers.AuthController.Login (VendingMachine.API) in 28.9454ms
2025-07-12 17:36:48.281 +03:00 [INF] Executed endpoint 'VendingMachine.API.Controllers.AuthController.Login (VendingMachine.API)'
2025-07-12 17:36:48.281 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/Auth/login - 400 null application/problem+json; charset=utf-8 79.9752ms
2025-07-12 17:37:05.427 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/Auth/login - application/json 49
2025-07-12 17:37:05.430 +03:00 [INF] CORS policy execution successful.
2025-07-12 17:37:05.435 +03:00 [INF] Executing endpoint 'VendingMachine.API.Controllers.AuthController.Login (VendingMachine.API)'
2025-07-12 17:37:05.436 +03:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(VendingMachine.API.Controllers.LoginDto) on controller VendingMachine.API.Controllers.AuthController (VendingMachine.API).
2025-07-12 17:37:05.505 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[@__username_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[Id], [u].[CreatedAt], [u].[Deposit], [u].[PasswordHash], [u].[Role], [u].[UpdatedAt], [u].[Username]
FROM [Users] AS [u]
WHERE [u].[Username] = @__username_0
2025-07-12 17:37:05.545 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType1`2[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[VendingMachine.Core.DTOs.UserResponseDto, VendingMachine.Core, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-12 17:37:05.549 +03:00 [INF] Executed action VendingMachine.API.Controllers.AuthController.Login (VendingMachine.API) in 112.1234ms
2025-07-12 17:37:05.551 +03:00 [INF] Executed endpoint 'VendingMachine.API.Controllers.AuthController.Login (VendingMachine.API)'
2025-07-12 17:37:05.552 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/Auth/login - 200 null application/json; charset=utf-8 125.5534ms
2025-07-12 17:37:24.185 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/Products - application/json 75
2025-07-12 17:37:24.188 +03:00 [INF] CORS policy execution successful.
2025-07-12 17:37:24.231 +03:00 [INF] Executing endpoint 'VendingMachine.API.Controllers.ProductsController.CreateProduct (VendingMachine.API)'
2025-07-12 17:37:24.237 +03:00 [INF] Route matched with {action = "CreateProduct", controller = "Products"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateProduct(VendingMachine.Core.DTOs.CreateProductDto) on controller VendingMachine.API.Controllers.ProductsController (VendingMachine.API).
2025-07-12 17:37:24.250 +03:00 [INF] Executed action VendingMachine.API.Controllers.ProductsController.CreateProduct (VendingMachine.API) in 11.6379ms
2025-07-12 17:37:24.252 +03:00 [INF] Executed endpoint 'VendingMachine.API.Controllers.ProductsController.CreateProduct (VendingMachine.API)'
2025-07-12 17:37:24.254 +03:00 [ERR] An unhandled exception has occurred while executing the request.
System.NullReferenceException: Object reference not set to an instance of an object.
   at VendingMachine.API.Controllers.ProductsController.CreateProduct(CreateProductDto dto) in C:\Users\osmohamed\Documents\Omar\Vending-machine\src\VendingMachine.API\Controllers\ProductsController.cs:line 37
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-07-12 17:37:24.285 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/Products - 500 null text/plain; charset=utf-8 100.2994ms
2025-07-12 17:37:33.872 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/Products - application/json 66
2025-07-12 17:37:33.875 +03:00 [INF] CORS policy execution successful.
2025-07-12 17:37:33.878 +03:00 [INF] Executing endpoint 'VendingMachine.API.Controllers.ProductsController.CreateProduct (VendingMachine.API)'
2025-07-12 17:37:33.884 +03:00 [INF] Route matched with {action = "CreateProduct", controller = "Products"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateProduct(VendingMachine.Core.DTOs.CreateProductDto) on controller VendingMachine.API.Controllers.ProductsController (VendingMachine.API).
2025-07-12 17:37:33.892 +03:00 [INF] Executed action VendingMachine.API.Controllers.ProductsController.CreateProduct (VendingMachine.API) in 5.7005ms
2025-07-12 17:37:33.896 +03:00 [INF] Executed endpoint 'VendingMachine.API.Controllers.ProductsController.CreateProduct (VendingMachine.API)'
2025-07-12 17:37:33.898 +03:00 [ERR] An unhandled exception has occurred while executing the request.
System.NullReferenceException: Object reference not set to an instance of an object.
   at VendingMachine.API.Controllers.ProductsController.CreateProduct(CreateProductDto dto) in C:\Users\osmohamed\Documents\Omar\Vending-machine\src\VendingMachine.API\Controllers\ProductsController.cs:line 37
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-07-12 17:37:33.909 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/Products - 500 null text/plain; charset=utf-8 36.8177ms
2025-07-12 17:46:13.125 +03:00 [INF] Application is shutting down...
2025-07-12 17:46:20.329 +03:00 [INF] User profile is available. Using 'C:\Users\osmohamed\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-07-12 17:46:20.411 +03:00 [INF] Now listening on: http://localhost:5000
2025-07-12 17:46:20.414 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-07-12 17:46:20.415 +03:00 [INF] Hosting environment: Development
2025-07-12 17:46:20.416 +03:00 [INF] Content root path: C:\Users\osmohamed\Documents\Omar\Vending-machine\src\VendingMachine.API
2025-07-12 17:46:44.253 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/Auth/login - application/json 49
2025-07-12 17:46:44.296 +03:00 [WRN] Failed to determine the https port for redirect.
2025-07-12 17:46:44.299 +03:00 [INF] CORS policy execution successful.
2025-07-12 17:46:44.395 +03:00 [INF] Executing endpoint 'VendingMachine.API.Controllers.AuthController.Login (VendingMachine.API)'
2025-07-12 17:46:44.429 +03:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(VendingMachine.API.Controllers.LoginDto) on controller VendingMachine.API.Controllers.AuthController (VendingMachine.API).
2025-07-12 17:46:45.706 +03:00 [INF] Executed DbCommand (43ms) [Parameters=[@__username_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[Id], [u].[CreatedAt], [u].[Deposit], [u].[PasswordHash], [u].[Role], [u].[UpdatedAt], [u].[Username]
FROM [Users] AS [u]
WHERE [u].[Username] = @__username_0
2025-07-12 17:46:45.811 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType1`2[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[VendingMachine.Core.DTOs.UserResponseDto, VendingMachine.Core, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-12 17:46:45.850 +03:00 [INF] Executed action VendingMachine.API.Controllers.AuthController.Login (VendingMachine.API) in 1415.08ms
2025-07-12 17:46:45.853 +03:00 [INF] Executed endpoint 'VendingMachine.API.Controllers.AuthController.Login (VendingMachine.API)'
2025-07-12 17:46:45.865 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/Auth/login - 200 null application/json; charset=utf-8 1614.5671ms
2025-07-12 17:46:57.174 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/Products - application/json 66
2025-07-12 17:46:57.183 +03:00 [INF] CORS policy execution successful.
2025-07-12 17:46:57.198 +03:00 [INF] Executing endpoint 'VendingMachine.API.Controllers.ProductsController.CreateProduct (VendingMachine.API)'
2025-07-12 17:46:57.213 +03:00 [INF] Route matched with {action = "CreateProduct", controller = "Products"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateProduct(VendingMachine.Core.DTOs.CreateProductDto) on controller VendingMachine.API.Controllers.ProductsController (VendingMachine.API).
2025-07-12 17:46:57.363 +03:00 [INF] Executed DbCommand (17ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (Precision = 18) (Scale = 2) (DbType = Decimal), @p2='?' (DbType = DateTime2), @p3='?' (Size = 100), @p4='?' (DbType = Int32), @p5='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Products] ([AmountAvailable], [Cost], [CreatedAt], [ProductName], [SellerId], [UpdatedAt])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5);
2025-07-12 17:46:57.485 +03:00 [INF] Executed DbCommand (34ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [p].[Id], [p].[AmountAvailable], [p].[Cost], [p].[CreatedAt], [p].[ProductName], [p].[SellerId], [p].[UpdatedAt], [u].[Id], [u].[CreatedAt], [u].[Deposit], [u].[PasswordHash], [u].[Role], [u].[UpdatedAt], [u].[Username]
FROM [Products] AS [p]
INNER JOIN [Users] AS [u] ON [p].[SellerId] = [u].[Id]
WHERE [p].[Id] = @__id_0
2025-07-12 17:46:57.498 +03:00 [INF] Executing CreatedAtActionResult, writing value of type 'VendingMachine.Core.DTOs.ProductResponseDto'.
2025-07-12 17:46:57.524 +03:00 [INF] Executed action VendingMachine.API.Controllers.ProductsController.CreateProduct (VendingMachine.API) in 308.6294ms
2025-07-12 17:46:57.526 +03:00 [INF] Executed endpoint 'VendingMachine.API.Controllers.ProductsController.CreateProduct (VendingMachine.API)'
2025-07-12 17:46:57.527 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/Products - 201 null application/json; charset=utf-8 353.0658ms
2025-07-12 17:47:11.761 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/api/Products/1 - null null
2025-07-12 17:47:11.777 +03:00 [INF] Executing endpoint 'VendingMachine.API.Controllers.ProductsController.GetProduct (VendingMachine.API)'
2025-07-12 17:47:11.785 +03:00 [INF] Route matched with {action = "GetProduct", controller = "Products"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetProduct(Int32) on controller VendingMachine.API.Controllers.ProductsController (VendingMachine.API).
2025-07-12 17:47:11.846 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [p].[Id], [p].[AmountAvailable], [p].[Cost], [p].[CreatedAt], [p].[ProductName], [p].[SellerId], [p].[UpdatedAt], [u].[Id], [u].[CreatedAt], [u].[Deposit], [u].[PasswordHash], [u].[Role], [u].[UpdatedAt], [u].[Username]
FROM [Products] AS [p]
INNER JOIN [Users] AS [u] ON [p].[SellerId] = [u].[Id]
WHERE [p].[Id] = @__id_0
2025-07-12 17:47:11.851 +03:00 [INF] Executing OkObjectResult, writing value of type 'VendingMachine.Core.DTOs.ProductResponseDto'.
2025-07-12 17:47:11.852 +03:00 [INF] Executed action VendingMachine.API.Controllers.ProductsController.GetProduct (VendingMachine.API) in 65.3231ms
2025-07-12 17:47:11.854 +03:00 [INF] Executed endpoint 'VendingMachine.API.Controllers.ProductsController.GetProduct (VendingMachine.API)'
2025-07-12 17:47:11.855 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5000/api/Products/1 - 200 null application/json; charset=utf-8 94.1606ms
2025-07-12 17:47:26.535 +03:00 [INF] Request starting HTTP/1.1 PUT http://localhost:5000/api/Products/1 - application/json 70
2025-07-12 17:47:26.538 +03:00 [INF] CORS policy execution successful.
2025-07-12 17:47:26.558 +03:00 [INF] Executing endpoint 'VendingMachine.API.Controllers.ProductsController.UpdateProduct (VendingMachine.API)'
2025-07-12 17:47:26.575 +03:00 [INF] Route matched with {action = "UpdateProduct", controller = "Products"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] UpdateProduct(Int32, VendingMachine.Core.DTOs.UpdateProductDto) on controller VendingMachine.API.Controllers.ProductsController (VendingMachine.API).
2025-07-12 17:47:26.613 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@__id_0='?' (DbType = Int32), @__sellerId_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [p].[Id], [p].[AmountAvailable], [p].[Cost], [p].[CreatedAt], [p].[ProductName], [p].[SellerId], [p].[UpdatedAt]
FROM [Products] AS [p]
WHERE [p].[Id] = @__id_0 AND [p].[SellerId] = @__sellerId_1
2025-07-12 17:47:26.626 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@p3='?' (DbType = Int32), @p0='?' (Precision = 18) (Scale = 2) (DbType = Decimal), @p1='?' (Size = 100), @p2='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Products] SET [Cost] = @p0, [ProductName] = @p1, [UpdatedAt] = @p2
OUTPUT 1
WHERE [Id] = @p3;
2025-07-12 17:47:26.634 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [p].[Id], [p].[AmountAvailable], [p].[Cost], [p].[CreatedAt], [p].[ProductName], [p].[SellerId], [p].[UpdatedAt], [u].[Id], [u].[CreatedAt], [u].[Deposit], [u].[PasswordHash], [u].[Role], [u].[UpdatedAt], [u].[Username]
FROM [Products] AS [p]
INNER JOIN [Users] AS [u] ON [p].[SellerId] = [u].[Id]
WHERE [p].[Id] = @__id_0
2025-07-12 17:47:26.638 +03:00 [INF] Executing OkObjectResult, writing value of type 'VendingMachine.Core.DTOs.ProductResponseDto'.
2025-07-12 17:47:26.639 +03:00 [INF] Executed action VendingMachine.API.Controllers.ProductsController.UpdateProduct (VendingMachine.API) in 59.5918ms
2025-07-12 17:47:26.640 +03:00 [INF] Executed endpoint 'VendingMachine.API.Controllers.ProductsController.UpdateProduct (VendingMachine.API)'
2025-07-12 17:47:26.641 +03:00 [INF] Request finished HTTP/1.1 PUT http://localhost:5000/api/Products/1 - 200 null application/json; charset=utf-8 105.835ms
2025-07-12 17:47:41.862 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/Buyer/deposit - application/json 19
2025-07-12 17:47:41.865 +03:00 [INF] CORS policy execution successful.
2025-07-12 17:47:41.868 +03:00 [INF] Authorization failed. These requirements were not met:
ClaimsAuthorizationRequirement:Claim.Type=role and Claim.Value is one of the following values: (Buyer)
2025-07-12 17:47:41.873 +03:00 [INF] AuthenticationScheme: Bearer was forbidden.
2025-07-12 17:47:41.874 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/Buyer/deposit - 403 0 null 12.6359ms
2025-07-12 17:47:52.555 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/Auth/register - application/json 63
2025-07-12 17:47:52.559 +03:00 [INF] CORS policy execution successful.
2025-07-12 17:47:52.561 +03:00 [INF] Executing endpoint 'VendingMachine.API.Controllers.AuthController.Register (VendingMachine.API)'
2025-07-12 17:47:52.568 +03:00 [INF] Route matched with {action = "Register", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Register(VendingMachine.Core.DTOs.CreateUserDto) on controller VendingMachine.API.Controllers.AuthController (VendingMachine.API).
2025-07-12 17:47:52.607 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[@__username_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Users] AS [u]
        WHERE [u].[Username] = @__username_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-07-12 17:47:52.627 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@p0='?' (DbType = DateTime2), @p1='?' (Precision = 18) (Scale = 2) (DbType = Decimal), @p2='?' (Size = 4000), @p3='?' (DbType = Int32), @p4='?' (DbType = DateTime2), @p5='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Users] ([CreatedAt], [Deposit], [PasswordHash], [Role], [UpdatedAt], [Username])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5);
2025-07-12 17:47:52.633 +03:00 [INF] Executing OkObjectResult, writing value of type 'VendingMachine.Core.DTOs.UserResponseDto'.
2025-07-12 17:47:52.635 +03:00 [INF] Executed action VendingMachine.API.Controllers.AuthController.Register (VendingMachine.API) in 63.9439ms
2025-07-12 17:47:52.636 +03:00 [INF] Executed endpoint 'VendingMachine.API.Controllers.AuthController.Register (VendingMachine.API)'
2025-07-12 17:47:52.638 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/Auth/register - 200 null application/json; charset=utf-8 82.3603ms
2025-07-12 17:47:58.664 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/Auth/login - application/json 50
2025-07-12 17:47:58.667 +03:00 [INF] CORS policy execution successful.
2025-07-12 17:47:58.669 +03:00 [INF] Executing endpoint 'VendingMachine.API.Controllers.AuthController.Login (VendingMachine.API)'
2025-07-12 17:47:58.670 +03:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(VendingMachine.API.Controllers.LoginDto) on controller VendingMachine.API.Controllers.AuthController (VendingMachine.API).
2025-07-12 17:47:58.678 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__username_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[Id], [u].[CreatedAt], [u].[Deposit], [u].[PasswordHash], [u].[Role], [u].[UpdatedAt], [u].[Username]
FROM [Users] AS [u]
WHERE [u].[Username] = @__username_0
2025-07-12 17:47:58.680 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType1`2[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[VendingMachine.Core.DTOs.UserResponseDto, VendingMachine.Core, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-12 17:47:58.683 +03:00 [INF] Executed action VendingMachine.API.Controllers.AuthController.Login (VendingMachine.API) in 10.6223ms
2025-07-12 17:47:58.684 +03:00 [INF] Executed endpoint 'VendingMachine.API.Controllers.AuthController.Login (VendingMachine.API)'
2025-07-12 17:47:58.685 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/Auth/login - 200 null application/json; charset=utf-8 21.4457ms
2025-07-12 17:48:15.972 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/Buyer/deposit - application/json 19
2025-07-12 17:48:15.976 +03:00 [INF] CORS policy execution successful.
2025-07-12 17:48:15.977 +03:00 [INF] Executing endpoint 'VendingMachine.API.Controllers.BuyerController.Deposit (VendingMachine.API)'
2025-07-12 17:48:15.981 +03:00 [INF] Route matched with {action = "Deposit", controller = "Buyer"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Deposit(VendingMachine.Core.DTOs.DepositDto) on controller VendingMachine.API.Controllers.BuyerController (VendingMachine.API).
2025-07-12 17:48:15.991 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-07-12 17:48:16.009 +03:00 [INF] Executed action VendingMachine.API.Controllers.BuyerController.Deposit (VendingMachine.API) in 25.7968ms
2025-07-12 17:48:16.011 +03:00 [INF] Executed endpoint 'VendingMachine.API.Controllers.BuyerController.Deposit (VendingMachine.API)'
2025-07-12 17:48:16.012 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/Buyer/deposit - 400 null application/problem+json; charset=utf-8 40.2179ms
2025-07-12 17:48:27.924 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/Buyer/deposit - application/json 19
2025-07-12 17:48:27.928 +03:00 [INF] CORS policy execution successful.
2025-07-12 17:48:27.929 +03:00 [INF] Executing endpoint 'VendingMachine.API.Controllers.BuyerController.Deposit (VendingMachine.API)'
2025-07-12 17:48:27.930 +03:00 [INF] Route matched with {action = "Deposit", controller = "Buyer"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Deposit(VendingMachine.Core.DTOs.DepositDto) on controller VendingMachine.API.Controllers.BuyerController (VendingMachine.API).
2025-07-12 17:48:27.934 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-07-12 17:48:27.936 +03:00 [INF] Executed action VendingMachine.API.Controllers.BuyerController.Deposit (VendingMachine.API) in 3.6903ms
2025-07-12 17:48:27.937 +03:00 [INF] Executed endpoint 'VendingMachine.API.Controllers.BuyerController.Deposit (VendingMachine.API)'
2025-07-12 17:48:27.938 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/Buyer/deposit - 400 null application/problem+json; charset=utf-8 13.7231ms
2025-07-12 17:48:33.162 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/Buyer/deposit - application/json 19
2025-07-12 17:48:33.165 +03:00 [INF] CORS policy execution successful.
2025-07-12 17:48:33.166 +03:00 [INF] Executing endpoint 'VendingMachine.API.Controllers.BuyerController.Deposit (VendingMachine.API)'
2025-07-12 17:48:33.167 +03:00 [INF] Route matched with {action = "Deposit", controller = "Buyer"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Deposit(VendingMachine.Core.DTOs.DepositDto) on controller VendingMachine.API.Controllers.BuyerController (VendingMachine.API).
2025-07-12 17:48:33.221 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[Id], [u].[CreatedAt], [u].[Deposit], [u].[PasswordHash], [u].[Role], [u].[UpdatedAt], [u].[Username]
FROM [Users] AS [u]
WHERE [u].[Id] = @__p_0
2025-07-12 17:48:33.232 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@p2='?' (DbType = Int32), @p0='?' (Precision = 18) (Scale = 2) (DbType = Decimal), @p1='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Users] SET [Deposit] = @p0, [UpdatedAt] = @p1
OUTPUT 1
WHERE [Id] = @p2;
2025-07-12 17:48:33.236 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType2`1[[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-12 17:48:33.239 +03:00 [INF] Executed action VendingMachine.API.Controllers.BuyerController.Deposit (VendingMachine.API) in 69.9357ms
2025-07-12 17:48:33.240 +03:00 [INF] Executed endpoint 'VendingMachine.API.Controllers.BuyerController.Deposit (VendingMachine.API)'
2025-07-12 17:48:33.241 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/Buyer/deposit - 200 null application/json; charset=utf-8 79.4325ms
2025-07-12 17:48:36.215 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/Buyer/deposit - application/json 19
2025-07-12 17:48:36.218 +03:00 [INF] CORS policy execution successful.
2025-07-12 17:48:36.219 +03:00 [INF] Executing endpoint 'VendingMachine.API.Controllers.BuyerController.Deposit (VendingMachine.API)'
2025-07-12 17:48:36.220 +03:00 [INF] Route matched with {action = "Deposit", controller = "Buyer"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Deposit(VendingMachine.Core.DTOs.DepositDto) on controller VendingMachine.API.Controllers.BuyerController (VendingMachine.API).
2025-07-12 17:48:36.226 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[Id], [u].[CreatedAt], [u].[Deposit], [u].[PasswordHash], [u].[Role], [u].[UpdatedAt], [u].[Username]
FROM [Users] AS [u]
WHERE [u].[Id] = @__p_0
2025-07-12 17:48:36.232 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@p2='?' (DbType = Int32), @p0='?' (Precision = 18) (Scale = 2) (DbType = Decimal), @p1='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Users] SET [Deposit] = @p0, [UpdatedAt] = @p1
OUTPUT 1
WHERE [Id] = @p2;
2025-07-12 17:48:36.234 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType2`1[[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-12 17:48:36.236 +03:00 [INF] Executed action VendingMachine.API.Controllers.BuyerController.Deposit (VendingMachine.API) in 14.6358ms
2025-07-12 17:48:36.237 +03:00 [INF] Executed endpoint 'VendingMachine.API.Controllers.BuyerController.Deposit (VendingMachine.API)'
2025-07-12 17:48:36.239 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/Buyer/deposit - 200 null application/json; charset=utf-8 23.5593ms
2025-07-12 17:48:54.305 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/Buyer/buy - application/json 44
2025-07-12 17:48:54.308 +03:00 [INF] CORS policy execution successful.
2025-07-12 17:48:54.309 +03:00 [INF] Executing endpoint 'VendingMachine.API.Controllers.BuyerController.Buy (VendingMachine.API)'
2025-07-12 17:48:54.313 +03:00 [INF] Route matched with {action = "Buy", controller = "Buyer"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Buy(VendingMachine.Core.DTOs.BuyDto) on controller VendingMachine.API.Controllers.BuyerController (VendingMachine.API).
2025-07-12 17:48:54.334 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[Id], [u].[CreatedAt], [u].[Deposit], [u].[PasswordHash], [u].[Role], [u].[UpdatedAt], [u].[Username]
FROM [Users] AS [u]
WHERE [u].[Id] = @__p_0
2025-07-12 17:48:54.343 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [p].[Id], [p].[AmountAvailable], [p].[Cost], [p].[CreatedAt], [p].[ProductName], [p].[SellerId], [p].[UpdatedAt]
FROM [Products] AS [p]
WHERE [p].[Id] = @__p_0
2025-07-12 17:48:54.346 +03:00 [INF] Executed action VendingMachine.API.Controllers.BuyerController.Buy (VendingMachine.API) in 30.8842ms
2025-07-12 17:48:54.348 +03:00 [INF] Executed endpoint 'VendingMachine.API.Controllers.BuyerController.Buy (VendingMachine.API)'
2025-07-12 17:48:54.352 +03:00 [ERR] An unhandled exception has occurred while executing the request.
System.Exception: Insufficient stock for this product
   at VendingMachine.Infrastructure.Services.BuyerService.BuyAsync(Int32 userId, Int32 productId, Int32 amount) in C:\Users\osmohamed\Documents\Omar\Vending-machine\src\VendingMachine.Infrastructure\Services\BuyerService.cs:line 39
   at VendingMachine.API.Controllers.BuyerController.Buy(BuyDto dto) in C:\Users\osmohamed\Documents\Omar\Vending-machine\src\VendingMachine.API\Controllers\BuyerController.cs:line 32
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-07-12 17:48:54.379 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/Buyer/buy - 500 null text/plain; charset=utf-8 73.8713ms
2025-07-12 17:49:10.178 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/Buyer/buy - application/json 35
2025-07-12 17:49:10.182 +03:00 [INF] CORS policy execution successful.
2025-07-12 17:49:10.183 +03:00 [INF] Executing endpoint 'VendingMachine.API.Controllers.BuyerController.Buy (VendingMachine.API)'
2025-07-12 17:49:10.184 +03:00 [INF] Route matched with {action = "Buy", controller = "Buyer"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Buy(VendingMachine.Core.DTOs.BuyDto) on controller VendingMachine.API.Controllers.BuyerController (VendingMachine.API).
2025-07-12 17:49:10.189 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[Id], [u].[CreatedAt], [u].[Deposit], [u].[PasswordHash], [u].[Role], [u].[UpdatedAt], [u].[Username]
FROM [Users] AS [u]
WHERE [u].[Id] = @__p_0
2025-07-12 17:49:10.193 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [p].[Id], [p].[AmountAvailable], [p].[Cost], [p].[CreatedAt], [p].[ProductName], [p].[SellerId], [p].[UpdatedAt]
FROM [Products] AS [p]
WHERE [p].[Id] = @__p_0
2025-07-12 17:49:10.242 +03:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-07-12 17:49:10.258 +03:00 [INF] Executed DbCommand (14ms) [Parameters=[@p6='?' (DbType = Int32), @p0='?' (DbType = Int32), @p1='?' (Precision = 18) (Scale = 2) (DbType = Decimal), @p2='?' (DbType = DateTime2), @p3='?' (Size = 100), @p4='?' (DbType = Int32), @p5='?' (DbType = DateTime2), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (Precision = 18) (Scale = 2) (DbType = Decimal), @p10='?' (DbType = DateTime2), @p11='?' (DbType = Int32), @p12='?' (Precision = 18) (Scale = 2) (DbType = Decimal), @p19='?' (DbType = Int32), @p13='?' (DbType = DateTime2), @p14='?' (Precision = 18) (Scale = 2) (DbType = Decimal), @p15='?' (Size = 4000), @p16='?' (DbType = Int32), @p17='?' (DbType = DateTime2), @p18='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
UPDATE [Products] SET [AmountAvailable] = @p0, [Cost] = @p1, [CreatedAt] = @p2, [ProductName] = @p3, [SellerId] = @p4, [UpdatedAt] = @p5
OUTPUT 1
WHERE [Id] = @p6;
INSERT INTO [Transactions] ([Amount], [BuyerId], [Change], [CreatedAt], [ProductId], [TotalSpent])
OUTPUT INSERTED.[Id]
VALUES (@p7, @p8, @p9, @p10, @p11, @p12);
UPDATE [Users] SET [CreatedAt] = @p13, [Deposit] = @p14, [PasswordHash] = @p15, [Role] = @p16, [UpdatedAt] = @p17, [Username] = @p18
OUTPUT 1
WHERE [Id] = @p19;
2025-07-12 17:49:10.271 +03:00 [INF] Executing OkObjectResult, writing value of type 'VendingMachine.Core.DTOs.BuyResponseDto'.
2025-07-12 17:49:10.275 +03:00 [INF] Executed action VendingMachine.API.Controllers.BuyerController.Buy (VendingMachine.API) in 89.9398ms
2025-07-12 17:49:10.276 +03:00 [INF] Executed endpoint 'VendingMachine.API.Controllers.BuyerController.Buy (VendingMachine.API)'
2025-07-12 17:49:10.277 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/Buyer/buy - 200 null application/json; charset=utf-8 99.3555ms
